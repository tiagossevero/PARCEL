[
{
  "model": "desktop.document2",
  "pk": 189328,
  "fields": {
    "owner": [
      "tsevero"
    ],
    "name": "PARCEL: Criar tbls",
    "description": "",
    "uuid": "5eeb06ef-0628-0a9a-8422-85b410b2be3d",
    "type": "query-impala",
    "connector": null,
    "data": "{\"id\": 189328, \"uuid\": \"05591c11-9f7e-4731-87b6-fa7fe745041f\", \"name\": \"PARCEL: Criar tbls\", \"description\": \"\", \"type\": \"query-impala\", \"initialType\": \"impala\", \"coordinatorUuid\": null, \"isHistory\": false, \"isManaged\": false, \"parentSavedQueryUuid\": \"5eeb06ef-0628-0a9a-8422-85b410b2be3d\", \"isSaved\": true, \"onSuccessUrl\": null, \"pubSubUrl\": null, \"isPresentationModeDefault\": false, \"isPresentationMode\": false, \"isPresentationModeInitialized\": true, \"presentationSnippets\": {}, \"isHidingCode\": false, \"snippets\": [{\"id\": \"5d972395-34e0-84c4-afd9-2f4ad9cd744b\", \"name\": \"\", \"type\": \"impala\", \"connector\": {\"name\": \"Impala\", \"type\": \"impala\", \"id\": \"impala\", \"displayName\": \"Impala\", \"buttonName\": \"Query\", \"tooltip\": \"Impala Query\", \"optimizer\": \"off\", \"page\": \"/editor/?type=impala\", \"is_sql\": true, \"is_batchable\": true, \"dialect\": \"impala\", \"dialect_properties\": {}}, \"isSqlDialect\": true, \"dialect\": \"impala\", \"isBatchable\": true, \"autocompleteSettings\": {\"temporaryOnly\": false}, \"aceCursorPosition\": {\"row\": 1398, \"column\": 83}, \"errors\": [], \"aceErrorsHolder\": [], \"aceWarningsHolder\": [], \"aceErrors\": [], \"aceWarnings\": [], \"editorMode\": true, \"dbSelectionVisible\": false, \"showExecutionAnalysis\": true, \"namespace\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"status\": \"CREATED\", \"computes\": [{\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"type\": \"direct\", \"credentials\": {}}]}, \"compute\": {\"id\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"name\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"namespace\": \"8271bb54-0cd9-47e1-89f2-a8a5de91d943\", \"interface\": \"impala\", \"type\": \"direct\", \"options\": {}}, \"database\": \"default\", \"currentQueryTab\": \"queryResults\", \"pinnedContextTabs\": [], \"loadingQueries\": false, \"queriesHasErrors\": false, \"queriesCurrentPage\": 1, \"queriesTotalPages\": 1, \"queriesFilter\": \"\", \"queriesFilterVisible\": false, \"statementType\": \"text\", \"statementTypes\": [\"text\", \"file\"], \"statementPath\": \"\", \"externalStatementLoaded\": false, \"associatedDocumentLoading\": true, \"associatedDocumentUuid\": null, \"statement_raw\": \"-- ================================================================================\\r\\n-- PROJETO PARCEL - Sistema de An\\u00e1lise e Monitoramento de Parcelamentos\\r\\n-- VERS\\u00c3O 1.0\\r\\n-- ================================================================================\\r\\n-- Objetivo: Criar tabelas anal\\u00edticas para dashboard Streamlit de parcelamentos\\r\\n--           incluindo m\\u00e9tricas, scores e proje\\u00e7\\u00f5es de recebimento\\r\\n-- Schema: gecob.parcel_*\\r\\n-- Autor: SEF/SC - Secretaria de Estado da Fazenda de Santa Catarina\\r\\n-- Data: Janeiro/2026\\r\\n-- ================================================================================\\r\\n-- \\r\\n-- MAPEAMENTO DE TABELAS FONTE (Big Data):\\r\\n-- | Schema.Tabela                              | Descri\\u00e7\\u00e3o                          |\\r\\n-- |--------------------------------------------|-------------------------------------|\\r\\n-- | usr_sat_ctacte.tab_parcelamento_pedido     | Tabela principal de parcelamentos   |\\r\\n-- | usr_sat_ctacte.tab_cta_cte                 | Conta corrente fiscal               |\\r\\n-- | usr_sat_ods.vw_ods_contrib                 | Cadastro de contribuintes           |\\r\\n-- | usr_sat_ods.vw_dva_divida_ativa            | D\\u00edvida Ativa                        |\\r\\n-- | usr_sat_ods.vw_ods_pagamento               | Pagamentos realizados               |\\r\\n--\\r\\n-- STATUS DOS PARCELAMENTOS:\\r\\n-- | C\\u00f3digo | Status                    | Descri\\u00e7\\u00e3o                               |\\r\\n-- |--------|---------------------------|-----------------------------------------|\\r\\n-- | 1      | ATIVO/ABERTO              | Parcelamento em andamento               |\\r\\n-- | 2      | CANCELADO                 | Cancelado (geralmente 90 dias sem pagar)|\\r\\n-- | 3      | INATIVO/SUSPENSO          | Temporariamente suspenso                |\\r\\n-- | 4      | PENDENTE AUTORIZA\\u00c7\\u00c3O      | Aguardando aprova\\u00e7\\u00e3o                    |\\r\\n-- | 5      | QUITADO                   | Todas as parcelas pagas                 |\\r\\n-- | 6      | PENDENTE 1\\u00aa PARCELA       | Contratou mas n\\u00e3o pagou primeira parcela|\\r\\n-- | 7      | EXCLU\\u00cdDO PAGTOS LIBERADOS | Exclu\\u00eddo com pagamentos liberados       |\\r\\n-- | 8      | SALDO TRANSFERIDO         | Saldo transferido para outro parcelam.  |\\r\\n--\\r\\n-- CATEGORIAS DE REGRAS DE PARCELAMENTO:\\r\\n-- | Receitas           | Categoria       |\\r\\n-- |--------------------|-----------------|\\r\\n-- | 1503, 1228, ...    | ICMS            |\\r\\n-- | 1546               | DECLARADO       |\\r\\n-- | 5835               | D\\u00cdVIDA ATIVA    |\\r\\n-- | 3107, 3085, ...    | ICMS            |\\r\\n-- | 2380, 2410, ...    | RECUPERA+       |\\r\\n-- | 7491               | IPVA            |\\r\\n-- | 8648               | ITCMD           |\\r\\n--\\r\\n-- TABELAS A SEREM CRIADAS:\\r\\n-- | Tabela                              | Descri\\u00e7\\u00e3o                              |\\r\\n-- |-------------------------------------|----------------------------------------|\\r\\n-- | parcel_base                         | Base unificada de parcelamentos        |\\r\\n-- | parcel_empresas                     | Perfil de empresas com parcelamentos   |\\r\\n-- | parcel_empresas_score               | Score de risco das empresas            |\\r\\n-- | parcel_expectativa_recebimento      | Proje\\u00e7\\u00e3o de recebimentos futuros       |\\r\\n-- | parcel_serie_temporal               | Evolu\\u00e7\\u00e3o temporal dos parcelamentos    |\\r\\n-- | parcel_metricas_gerfe               | M\\u00e9tricas por GERFE (regional)          |\\r\\n-- | parcel_metricas_ges                 | M\\u00e9tricas por GES (ger\\u00eancia setorial)   |\\r\\n-- | parcel_recuperamais                 | An\\u00e1lise espec\\u00edfica RECUPERA+           |\\r\\n-- | parcel_programas_especiais          | An\\u00e1lise de programas especiais (REFIS) |\\r\\n-- | parcel_alertas                      | Alertas de parcelamentos em risco      |\\r\\n-- | parcel_resumo_executivo             | KPIs consolidados para dashboard       |\\r\\n-- ================================================================================\\r\\n\\r\\nSET REQUEST_POOL = 'medium';\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 1: BASE UNIFICADA DE PARCELAMENTOS\\r\\n-- ================================================================================\\r\\n-- Consolida todos os parcelamentos com enriquecimento de dados cadastrais\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_base;\\r\\nCREATE TABLE gecob.parcel_base STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O DO PARCELAMENTO ====================\\r\\n    tpa.TPA_NUM_PARCELAMENTO AS num_parcelamento,\\r\\n    tpa.TPA_REGRA AS regra,\\r\\n    tpa.TPA_MCR_COD_RCTA AS cod_receita,\\r\\n    \\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O DO CONTRIBUINTE ====================\\r\\n    TRIM(tpa.TPA_RGE_RUC) AS inscricao_estadual,\\r\\n    TRIM(oc.nu_cnpj) AS cnpj,\\r\\n    TRIM(SUBSTR(oc.nu_cnpj, 1, 8)) AS cnpj_raiz,\\r\\n    oc.nm_razao_social AS razao_social,\\r\\n    oc.nm_fantasia AS nome_fantasia,\\r\\n    \\r\\n    -- ==================== STATUS E CLASSIFICA\\u00c7\\u00c3O ====================\\r\\n    tpa.TPA_STATUS AS cd_status,\\r\\n    CASE tpa.TPA_STATUS\\r\\n        WHEN 1 THEN 'ATIVO'\\r\\n        WHEN 2 THEN 'CANCELADO'\\r\\n        WHEN 3 THEN 'SUSPENSO'\\r\\n        WHEN 4 THEN 'PENDENTE AUTORIZA\\u00c7\\u00c3O'\\r\\n        WHEN 5 THEN 'QUITADO'\\r\\n        WHEN 6 THEN 'PENDENTE 1\\u00aa PARCELA'\\r\\n        WHEN 7 THEN 'EXCLU\\u00cdDO PAGTOS LIBERADOS'\\r\\n        WHEN 8 THEN 'SALDO TRANSFERIDO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS desc_status,\\r\\n    \\r\\n    -- Indicador simplificado de situa\\u00e7\\u00e3o final\\r\\n    CASE \\r\\n        WHEN tpa.TPA_STATUS = 5 THEN 'SUCESSO'\\r\\n        WHEN tpa.TPA_STATUS = 2 THEN 'FRACASSO'\\r\\n        WHEN tpa.TPA_STATUS = 1 THEN 'EM ANDAMENTO'\\r\\n        WHEN tpa.TPA_STATUS = 6 THEN 'NAO INICIADO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS situacao_final,\\r\\n    \\r\\n    -- ==================== CATEGORIA DO PARCELAMENTO ====================\\r\\n    CASE \\r\\n        WHEN tpa.TPA_MCR_COD_RCTA IN (2380, 2399, 2402, 2410, 2348, 2356, 2364, 2372) \\r\\n            THEN 'RECUPERA+'\\r\\n        WHEN tpa.TPA_MCR_COD_RCTA IN (5835) OR tpa.TPA_IND_DIVIDA_ATIVA = 1 \\r\\n            THEN 'D\\u00cdVIDA ATIVA'\\r\\n        WHEN tpa.TPA_MCR_COD_RCTA IN (1546) \\r\\n            THEN 'DECLARADO'\\r\\n        WHEN tpa.TPA_MCR_COD_RCTA IN (7491) \\r\\n            THEN 'IPVA'\\r\\n        WHEN tpa.TPA_MCR_COD_RCTA IN (8648) \\r\\n            THEN 'ITCMD'\\r\\n        WHEN tpa.TPA_MCR_COD_RCTA IN (1503, 1228, 3107, 3085, 2950, 1830, 5673, 1449, 1465, \\r\\n                                      1473, 1554, 1570, 1589, 1597, 1600, 1643, 1651, 1716, \\r\\n                                      1724, 1732, 1740, 1759, 1767, 1783, 1791, 2140, 2496, \\r\\n                                      2526, 2534, 3000, 3050, 3662, 4383, 7110, 7137, 9687, 9784)\\r\\n            THEN 'ICMS'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS categoria_parcelamento,\\r\\n    \\r\\n    -- Flag Programa Especial (REFIS/PREFIS)\\r\\n    CASE \\r\\n        WHEN tpa.TPA_REGRA IN (293, 294, 295, 296) THEN 1  -- RECUPERA+ (Conv. 113/2023)\\r\\n        WHEN tpa.TPA_REGRA IN (241, 245) THEN 1  -- ITCMD especial\\r\\n        WHEN tpa.TPA_REGRA BETWEEN 290 AND 310 THEN 1  -- Faixa de programas especiais\\r\\n        ELSE 0\\r\\n    END AS flag_programa_especial,\\r\\n    \\r\\n    -- ==================== VALORES FINANCEIROS ====================\\r\\n    CAST(COALESCE(tpa.TPA_SALDO_PARCELADO, 0) AS DECIMAL(18,2)) AS valor_parcelado,\\r\\n    CAST(COALESCE(tpa.TPA_SALDO_DIVIDA, 0) AS DECIMAL(18,2)) AS saldo_divida,\\r\\n    CAST(COALESCE(tpa.TPA_SALDO_IMPOSTO, 0) AS DECIMAL(18,2)) AS saldo_imposto,\\r\\n    CAST(COALESCE(tpa.TPA_SALDO_MULTA, 0) AS DECIMAL(18,2)) AS saldo_multa,\\r\\n    CAST(COALESCE(tpa.TPA_SALDO_JUROS, 0) AS DECIMAL(18,2)) AS saldo_juros,\\r\\n    CAST(COALESCE(tpa.TPA_SALDO_REAJUSTE, 0) AS DECIMAL(18,2)) AS saldo_reajuste,\\r\\n    CAST(COALESCE(tpa.TPA_SALDO_CREDITO, 0) AS DECIMAL(18,2)) AS saldo_credito,\\r\\n    \\r\\n    -- Valor m\\u00e9dio por parcela (estimativa)\\r\\n    CASE \\r\\n        WHEN tpa.TPA_NUM_PARCELAS > 0 \\r\\n        THEN CAST(tpa.TPA_SALDO_PARCELADO / tpa.TPA_NUM_PARCELAS AS DECIMAL(18,2))\\r\\n        ELSE 0.00\\r\\n    END AS valor_medio_parcela,\\r\\n    \\r\\n    -- ==================== PARCELAS ====================\\r\\n    tpa.TPA_NUM_PARCELAS AS num_parcelas,\\r\\n    \\r\\n    -- Faixa de parcelas para an\\u00e1lise\\r\\n    CASE \\r\\n        WHEN tpa.TPA_NUM_PARCELAS = 1 THEN '01 - Cota \\u00danica'\\r\\n        WHEN tpa.TPA_NUM_PARCELAS BETWEEN 2 AND 12 THEN '02-12 parcelas'\\r\\n        WHEN tpa.TPA_NUM_PARCELAS BETWEEN 13 AND 24 THEN '13-24 parcelas'\\r\\n        WHEN tpa.TPA_NUM_PARCELAS BETWEEN 25 AND 36 THEN '25-36 parcelas'\\r\\n        WHEN tpa.TPA_NUM_PARCELAS BETWEEN 37 AND 60 THEN '37-60 parcelas'\\r\\n        WHEN tpa.TPA_NUM_PARCELAS BETWEEN 61 AND 120 THEN '61-120 parcelas'\\r\\n        WHEN tpa.TPA_NUM_PARCELAS > 120 THEN '121+ parcelas'\\r\\n        ELSE 'N\\u00e3o informado'\\r\\n    END AS faixa_parcelas,\\r\\n    \\r\\n    -- ==================== DATAS ====================\\r\\n    tpa.TPA_DT_PEDIDO AS dt_pedido,\\r\\n    tpa.TPA_DT_AUTORIZACAO AS dt_autorizacao,\\r\\n    tpa.TPA_DT_CANCELAMENTO AS dt_cancelamento,\\r\\n    tpa.TPA_DT_PRAZO_PAGAMENTO AS dt_prazo_pagamento,\\r\\n    tpa.TPA_DT_ULT_CALCULO AS dt_ultimo_calculo,\\r\\n    tpa.TPA_DT_ATUALIZACAO AS dt_atualizacao,\\r\\n    tpa.TPA_DT_INCLUSAO AS dt_inclusao,\\r\\n    \\r\\n    -- Ano/M\\u00eas do pedido (para slicers)\\r\\n    YEAR(tpa.TPA_DT_PEDIDO) AS ano_pedido,\\r\\n    MONTH(tpa.TPA_DT_PEDIDO) AS mes_pedido,\\r\\n    CAST(YEAR(tpa.TPA_DT_PEDIDO) * 100 + MONTH(tpa.TPA_DT_PEDIDO) AS INT) AS periodo_pedido,\\r\\n    \\r\\n    -- Tempo de vida do parcelamento\\r\\n    DATEDIFF(\\r\\n        COALESCE(tpa.TPA_DT_CANCELAMENTO, CURRENT_DATE()), \\r\\n        tpa.TPA_DT_PEDIDO\\r\\n    ) AS dias_vida_parcelamento,\\r\\n    \\r\\n    -- Tempo at\\u00e9 cancelamento (se cancelado)\\r\\n    CASE \\r\\n        WHEN tpa.TPA_STATUS = 2 AND tpa.TPA_DT_CANCELAMENTO IS NOT NULL\\r\\n        THEN DATEDIFF(tpa.TPA_DT_CANCELAMENTO, tpa.TPA_DT_PEDIDO)\\r\\n        ELSE NULL\\r\\n    END AS dias_ate_cancelamento,\\r\\n    \\r\\n    -- ==================== MOTIVO CANCELAMENTO ====================\\r\\n    tpa.TPA_TIPO_CANCELAMENTO AS cd_tipo_cancelamento,\\r\\n    CASE tpa.TPA_TIPO_CANCELAMENTO\\r\\n        WHEN 1 THEN 'INADIMPL\\u00caNCIA'\\r\\n        WHEN 2 THEN 'SUBSTITUI\\u00c7\\u00c3O'\\r\\n        WHEN 3 THEN 'SOLICITA\\u00c7\\u00c3O CONTRIBUINTE'\\r\\n        WHEN 4 THEN 'ERRO NO PARCELAMENTO'\\r\\n        WHEN 5 THEN 'DECIS\\u00c3O JUDICIAL'\\r\\n        WHEN 6 THEN 'CONVERS\\u00c3O'\\r\\n        WHEN 7 THEN 'SALDO ZERADO'\\r\\n        ELSE 'N\\u00c3O INFORMADO'\\r\\n    END AS desc_tipo_cancelamento,\\r\\n    \\r\\n    -- ==================== FLAGS ESPECIAIS ====================\\r\\n    CAST(tpa.TPA_IND_DIVIDA_ATIVA AS INT) AS flag_divida_ativa,\\r\\n    tpa.TPA_ORIGEM_SISTEMA AS origem_sistema,\\r\\n    tpa.TPA_TIPO_DIVIDA AS tipo_divida,\\r\\n    tpa.TPA_NUM_PROC_ADM AS num_processo_adm,\\r\\n    \\r\\n    -- ==================== DADOS CADASTRAIS ====================\\r\\n    oc.cd_sit_cadastral AS cd_situacao_cadastral,\\r\\n    oc.nm_sit_cadastral AS situacao_cadastral,\\r\\n    CAST(oc.cd_cnae AS STRING) AS cnae,\\r\\n    oc.de_classe AS descricao_cnae,\\r\\n    oc.cd_secao AS secao_cnae,\\r\\n    oc.de_secao AS descricao_secao,\\r\\n    oc.nm_reg_apuracao AS regime_apuracao,\\r\\n    oc.nm_enq_empresa AS enquadramento_empresa,\\r\\n    CAST(oc.sn_simples_nacional_rfb AS INT) AS flag_simples_nacional,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O ====================\\r\\n    oc.cd_gerfe AS cd_gerfe,\\r\\n    oc.nm_gerfe AS gerfe,\\r\\n    oc.cd_ges AS cd_ges,\\r\\n    oc.nm_ges AS ges,\\r\\n    oc.cd_usefi AS cd_usefi,\\r\\n    oc.nm_usefi AS usefi,\\r\\n    oc.cd_munic AS cd_municipio,\\r\\n    oc.nm_munic AS municipio,\\r\\n    oc.cd_uf AS uf,\\r\\n    \\r\\n    -- ==================== USU\\u00c1RIOS ====================\\r\\n    tpa.TPA_TUS_COD_USR AS usuario_cadastro,\\r\\n    tpa.TPA_TUS_COD_USR_AUT AS usuario_autorizacao,\\r\\n    tpa.TPA_TUS_COD_USR_CANCEL AS usuario_cancelamento,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O PARCELAMENTO ====================\\r\\n    tpa.TPA_USEFI AS usefi_parcelamento,\\r\\n    tpa.TPA_GEREG AS gereg_parcelamento,\\r\\n    tpa.TPA_MUNICIPIO AS municipio_parcelamento,\\r\\n    \\r\\n    -- ==================== METADADOS ====================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM usr_sat_ctacte.tab_parcelamento_pedido tpa\\r\\nLEFT JOIN usr_sat_ods.vw_ods_contrib oc \\r\\n    ON TRIM(tpa.TPA_RGE_RUC) = TRIM(oc.nu_ie)\\r\\nWHERE tpa.TPA_DT_PEDIDO >= DATE_SUB(CURRENT_DATE(), 3650)  -- \\u00daltimos 10 anos\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 2: PERFIL DE EMPRESAS COM PARCELAMENTOS\\r\\n-- ================================================================================\\r\\n-- Consolida o comportamento hist\\u00f3rico de cada empresa com parcelamentos\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_empresas;\\r\\nCREATE TABLE gecob.parcel_empresas STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O ====================\\r\\n    cnpj_raiz,\\r\\n    MAX(cnpj) AS cnpj,\\r\\n    MAX(inscricao_estadual) AS inscricao_estadual,\\r\\n    MAX(razao_social) AS razao_social,\\r\\n    MAX(nome_fantasia) AS nome_fantasia,\\r\\n    \\r\\n    -- ==================== CONTADORES DE PARCELAMENTOS ====================\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a_parcela,\\r\\n    SUM(CASE WHEN cd_status IN (3, 4, 7, 8) THEN 1 ELSE 0 END) AS qtd_outros,\\r\\n    \\r\\n    -- Parcelamentos por categoria\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'ICMS' THEN 1 ELSE 0 END) AS qtd_parcel_icms,\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'D\\u00cdVIDA ATIVA' THEN 1 ELSE 0 END) AS qtd_parcel_dva,\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'DECLARADO' THEN 1 ELSE 0 END) AS qtd_parcel_declarado,\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'RECUPERA+' THEN 1 ELSE 0 END) AS qtd_parcel_recuperamais,\\r\\n    SUM(CASE WHEN flag_programa_especial = 1 THEN 1 ELSE 0 END) AS qtd_programas_especiais,\\r\\n    \\r\\n    -- ==================== TAXAS DE SUCESSO ====================\\r\\n    -- Taxa geral (quitados / finalizados)\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Taxa de cancelamento por inadimpl\\u00eancia\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 1 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_inadimplencia_pct,\\r\\n    \\r\\n    -- Taxa de substitui\\u00e7\\u00e3o\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 2 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_substituicao_pct,\\r\\n    \\r\\n    -- ==================== VALORES ====================\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total_parcelado,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN cd_status = 2 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN cd_status = 5 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- M\\u00e9dia por parcelamento\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS valor_medio_parcelamento,\\r\\n    CAST(AVG(num_parcelas) AS DECIMAL(10,1)) AS media_parcelas,\\r\\n    \\r\\n    -- Valores por componente (para parcelamentos ativos)\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN saldo_imposto ELSE 0 END) AS DECIMAL(18,2)) AS imposto_ativo,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN saldo_multa ELSE 0 END) AS DECIMAL(18,2)) AS multa_ativo,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN saldo_juros ELSE 0 END) AS DECIMAL(18,2)) AS juros_ativo,\\r\\n    \\r\\n    -- ==================== TEMPO ====================\\r\\n    CAST(AVG(CASE WHEN cd_status = 5 THEN dias_vida_parcelamento ELSE NULL END) AS INT) AS media_dias_quitacao,\\r\\n    CAST(AVG(dias_ate_cancelamento) AS INT) AS media_dias_ate_cancelamento,\\r\\n    \\r\\n    -- Primeiro e \\u00faltimo parcelamento\\r\\n    MIN(dt_pedido) AS dt_primeiro_parcelamento,\\r\\n    MAX(dt_pedido) AS dt_ultimo_parcelamento,\\r\\n    DATEDIFF(CURRENT_DATE(), MAX(dt_pedido)) AS dias_desde_ultimo_parcelamento,\\r\\n    \\r\\n    -- ==================== CLASSIFICA\\u00c7\\u00c3O DE COMPORTAMENTO ====================\\r\\n    CASE \\r\\n        WHEN SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) = 0 \\r\\n             AND SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) > 0 \\r\\n            THEN 'BOM PAGADOR'\\r\\n        WHEN SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) > SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END)\\r\\n            THEN 'REGULAR'\\r\\n        WHEN SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) > 0 \\r\\n             AND SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) = 0\\r\\n            THEN 'ALTO RISCO'\\r\\n        WHEN SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) >= SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END)\\r\\n            THEN 'RISCO MODERADO'\\r\\n        ELSE 'SEM HIST\\u00d3RICO DEFINIDO'\\r\\n    END AS classificacao_comportamento,\\r\\n    \\r\\n    -- Flag: Empresa reincidente (mais de 3 cancelamentos)\\r\\n    CASE \\r\\n        WHEN SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) >= 3 THEN 1 \\r\\n        ELSE 0 \\r\\n    END AS flag_reincidente,\\r\\n    \\r\\n    -- Flag: Nunca quitou um parcelamento\\r\\n    CASE \\r\\n        WHEN SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) = 0 \\r\\n             AND COUNT(*) > 1 THEN 1 \\r\\n        ELSE 0 \\r\\n    END AS flag_nunca_quitou,\\r\\n    \\r\\n    -- ==================== DADOS CADASTRAIS ====================\\r\\n    MAX(situacao_cadastral) AS situacao_cadastral,\\r\\n    MAX(cnae) AS cnae,\\r\\n    MAX(descricao_cnae) AS descricao_cnae,\\r\\n    MAX(secao_cnae) AS secao_cnae,\\r\\n    MAX(regime_apuracao) AS regime_apuracao,\\r\\n    MAX(enquadramento_empresa) AS enquadramento_empresa,\\r\\n    MAX(flag_simples_nacional) AS flag_simples_nacional,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O ====================\\r\\n    MAX(cd_gerfe) AS cd_gerfe,\\r\\n    MAX(gerfe) AS gerfe,\\r\\n    MAX(cd_ges) AS cd_ges,\\r\\n    MAX(ges) AS ges,\\r\\n    MAX(municipio) AS municipio,\\r\\n    MAX(uf) AS uf,\\r\\n    \\r\\n    -- ==================== METADADOS ====================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE cnpj_raiz IS NOT NULL\\r\\nGROUP BY cnpj_raiz\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 3: SCORE DE RISCO DAS EMPRESAS\\r\\n-- ================================================================================\\r\\n-- Calcula um score de risco para prioriza\\u00e7\\u00e3o e an\\u00e1lise\\r\\n-- NOTA: Evitando percentile_approx que pode n\\u00e3o estar dispon\\u00edvel\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_empresas_score;\\r\\nCREATE TABLE gecob.parcel_empresas_score STORED AS PARQUET AS\\r\\nWITH base_scores AS (\\r\\n    SELECT\\r\\n        cnpj_raiz,\\r\\n        cnpj,\\r\\n        inscricao_estadual,\\r\\n        razao_social,\\r\\n        \\r\\n        -- Componentes do Score (0-100 cada, normalizados depois)\\r\\n        \\r\\n        -- 1. Score de Hist\\u00f3rico de Cancelamentos (peso 30)\\r\\n        -- Mais cancelamentos = maior risco\\r\\n        CASE \\r\\n            WHEN total_parcelamentos = 0 THEN 50\\r\\n            WHEN (qtd_cancelados * 1.0 / total_parcelamentos) >= 0.8 THEN 100\\r\\n            WHEN (qtd_cancelados * 1.0 / total_parcelamentos) >= 0.6 THEN 80\\r\\n            WHEN (qtd_cancelados * 1.0 / total_parcelamentos) >= 0.4 THEN 60\\r\\n            WHEN (qtd_cancelados * 1.0 / total_parcelamentos) >= 0.2 THEN 40\\r\\n            ELSE 20\\r\\n        END AS score_historico_cancelamento,\\r\\n        \\r\\n        -- 2. Score de Rec\\u00eancia (peso 20)\\r\\n        -- Cancelamento recente = maior risco\\r\\n        CASE \\r\\n            WHEN dias_desde_ultimo_parcelamento <= 30 THEN 100\\r\\n            WHEN dias_desde_ultimo_parcelamento <= 90 THEN 80\\r\\n            WHEN dias_desde_ultimo_parcelamento <= 180 THEN 60\\r\\n            WHEN dias_desde_ultimo_parcelamento <= 365 THEN 40\\r\\n            ELSE 20\\r\\n        END AS score_recencia,\\r\\n        \\r\\n        -- 3. Score de Valor em Risco (peso 25)\\r\\n        -- Maior valor ativo = mais aten\\u00e7\\u00e3o necess\\u00e1ria\\r\\n        CASE \\r\\n            WHEN valor_ativos >= 10000000 THEN 100\\r\\n            WHEN valor_ativos >= 1000000 THEN 80\\r\\n            WHEN valor_ativos >= 100000 THEN 60\\r\\n            WHEN valor_ativos >= 10000 THEN 40\\r\\n            ELSE 20\\r\\n        END AS score_valor_risco,\\r\\n        \\r\\n        -- 4. Score de Reincid\\u00eancia (peso 15)\\r\\n        CASE \\r\\n            WHEN flag_reincidente = 1 THEN 100\\r\\n            WHEN qtd_cancelados >= 2 THEN 75\\r\\n            WHEN qtd_cancelados = 1 THEN 50\\r\\n            ELSE 20\\r\\n        END AS score_reincidencia,\\r\\n        \\r\\n        -- 5. Score de Comportamento (peso 10)\\r\\n        CASE classificacao_comportamento\\r\\n            WHEN 'ALTO RISCO' THEN 100\\r\\n            WHEN 'RISCO MODERADO' THEN 75\\r\\n            WHEN 'SEM HIST\\u00d3RICO DEFINIDO' THEN 50\\r\\n            WHEN 'REGULAR' THEN 35\\r\\n            WHEN 'BOM PAGADOR' THEN 10\\r\\n            ELSE 50\\r\\n        END AS score_comportamento,\\r\\n        \\r\\n        -- Dados para contexto\\r\\n        total_parcelamentos,\\r\\n        qtd_ativos,\\r\\n        qtd_cancelados,\\r\\n        qtd_quitados,\\r\\n        valor_ativos,\\r\\n        valor_cancelados,\\r\\n        valor_quitados,\\r\\n        taxa_sucesso_pct,\\r\\n        flag_reincidente,\\r\\n        flag_nunca_quitou,\\r\\n        classificacao_comportamento,\\r\\n        \\r\\n        -- Localiza\\u00e7\\u00e3o\\r\\n        cd_gerfe,\\r\\n        gerfe,\\r\\n        cd_ges,\\r\\n        ges,\\r\\n        municipio,\\r\\n        \\r\\n        -- Cadastrais\\r\\n        situacao_cadastral,\\r\\n        cnae,\\r\\n        descricao_cnae,\\r\\n        regime_apuracao\\r\\n        \\r\\n    FROM gecob.parcel_empresas\\r\\n)\\r\\nSELECT\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Scores individuais\\r\\n    score_historico_cancelamento,\\r\\n    score_recencia,\\r\\n    score_valor_risco,\\r\\n    score_reincidencia,\\r\\n    score_comportamento,\\r\\n    \\r\\n    -- SCORE FINAL PONDERADO (0-100)\\r\\n    CAST(\\r\\n        (score_historico_cancelamento * 0.30) +\\r\\n        (score_recencia * 0.20) +\\r\\n        (score_valor_risco * 0.25) +\\r\\n        (score_reincidencia * 0.15) +\\r\\n        (score_comportamento * 0.10)\\r\\n    AS DECIMAL(5,2)) AS score_risco_final,\\r\\n    \\r\\n    -- Classifica\\u00e7\\u00e3o do Score\\r\\n    CASE \\r\\n        WHEN (score_historico_cancelamento * 0.30) +\\r\\n             (score_recencia * 0.20) +\\r\\n             (score_valor_risco * 0.25) +\\r\\n             (score_reincidencia * 0.15) +\\r\\n             (score_comportamento * 0.10) >= 80 THEN 'CR\\u00cdTICO'\\r\\n        WHEN (score_historico_cancelamento * 0.30) +\\r\\n             (score_recencia * 0.20) +\\r\\n             (score_valor_risco * 0.25) +\\r\\n             (score_reincidencia * 0.15) +\\r\\n             (score_comportamento * 0.10) >= 60 THEN 'ALTO'\\r\\n        WHEN (score_historico_cancelamento * 0.30) +\\r\\n             (score_recencia * 0.20) +\\r\\n             (score_valor_risco * 0.25) +\\r\\n             (score_reincidencia * 0.15) +\\r\\n             (score_comportamento * 0.10) >= 40 THEN 'M\\u00c9DIO'\\r\\n        ELSE 'BAIXO'\\r\\n    END AS classificacao_risco,\\r\\n    \\r\\n    -- Dados de contexto\\r\\n    total_parcelamentos,\\r\\n    qtd_ativos,\\r\\n    qtd_cancelados,\\r\\n    qtd_quitados,\\r\\n    valor_ativos,\\r\\n    valor_cancelados,\\r\\n    valor_quitados,\\r\\n    taxa_sucesso_pct,\\r\\n    flag_reincidente,\\r\\n    flag_nunca_quitou,\\r\\n    classificacao_comportamento,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- Cadastrais\\r\\n    situacao_cadastral,\\r\\n    cnae,\\r\\n    descricao_cnae,\\r\\n    regime_apuracao,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM base_scores\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 4: EXPECTATIVA DE RECEBIMENTO FUTURO\\r\\n-- ================================================================================\\r\\n-- Proje\\u00e7\\u00e3o de valores a receber dos parcelamentos ativos\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_expectativa_recebimento;\\r\\nCREATE TABLE gecob.parcel_expectativa_recebimento STORED AS PARQUET AS\\r\\nWITH parcelamentos_ativos AS (\\r\\n    SELECT\\r\\n        pb.*,\\r\\n        -- Estimativa de parcelas restantes (simplificada)\\r\\n        -- Considera tempo desde o in\\u00edcio e n\\u00famero total de parcelas\\r\\n        GREATEST(\\r\\n            pb.num_parcelas - CEIL(pb.dias_vida_parcelamento / 30.0),\\r\\n            0\\r\\n        ) AS parcelas_restantes_estimada,\\r\\n        \\r\\n        -- Score de risco da empresa (se dispon\\u00edvel)\\r\\n        COALESCE(es.score_risco_final, 50) AS score_empresa,\\r\\n        COALESCE(es.classificacao_risco, 'N\\u00c3O AVALIADO') AS risco_empresa\\r\\n        \\r\\n    FROM gecob.parcel_base pb\\r\\n    LEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\n    WHERE pb.cd_status = 1  -- Apenas ATIVOS\\r\\n)\\r\\nSELECT\\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O ====================\\r\\n    num_parcelamento,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- ==================== DETALHES DO PARCELAMENTO ====================\\r\\n    regra,\\r\\n    categoria_parcelamento,\\r\\n    num_parcelas,\\r\\n    valor_parcelado,\\r\\n    valor_medio_parcela,\\r\\n    dt_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    \\r\\n    -- ==================== ESTIMATIVAS ====================\\r\\n    CAST(parcelas_restantes_estimada AS INT) AS parcelas_restantes,\\r\\n    \\r\\n    -- Valor restante estimado\\r\\n    CAST(valor_medio_parcela * parcelas_restantes_estimada AS DECIMAL(18,2)) AS valor_restante_estimado,\\r\\n    \\r\\n    -- Distribui\\u00e7\\u00e3o por horizonte temporal\\r\\n    -- Pr\\u00f3ximos 3 meses\\r\\n    CAST(\\r\\n        CASE \\r\\n            WHEN parcelas_restantes_estimada >= 3 \\r\\n            THEN valor_medio_parcela * 3\\r\\n            ELSE valor_medio_parcela * parcelas_restantes_estimada\\r\\n        END \\r\\n    AS DECIMAL(18,2)) AS valor_esperado_3_meses,\\r\\n    \\r\\n    -- Pr\\u00f3ximos 6 meses\\r\\n    CAST(\\r\\n        CASE \\r\\n            WHEN parcelas_restantes_estimada >= 6 \\r\\n            THEN valor_medio_parcela * 6\\r\\n            ELSE valor_medio_parcela * parcelas_restantes_estimada\\r\\n        END \\r\\n    AS DECIMAL(18,2)) AS valor_esperado_6_meses,\\r\\n    \\r\\n    -- Pr\\u00f3ximos 12 meses\\r\\n    CAST(\\r\\n        CASE \\r\\n            WHEN parcelas_restantes_estimada >= 12 \\r\\n            THEN valor_medio_parcela * 12\\r\\n            ELSE valor_medio_parcela * parcelas_restantes_estimada\\r\\n        END \\r\\n    AS DECIMAL(18,2)) AS valor_esperado_12_meses,\\r\\n    \\r\\n    -- ==================== AJUSTE POR RISCO ====================\\r\\n    score_empresa,\\r\\n    risco_empresa,\\r\\n    \\r\\n    -- Probabilidade de sucesso baseada no risco\\r\\n    CASE risco_empresa\\r\\n        WHEN 'BAIXO' THEN 0.85\\r\\n        WHEN 'M\\u00c9DIO' THEN 0.65\\r\\n        WHEN 'ALTO' THEN 0.40\\r\\n        WHEN 'CR\\u00cdTICO' THEN 0.20\\r\\n        ELSE 0.50\\r\\n    END AS probabilidade_sucesso,\\r\\n    \\r\\n    -- Valor esperado ajustado pelo risco (3 meses)\\r\\n    CAST(\\r\\n        CASE \\r\\n            WHEN parcelas_restantes_estimada >= 3 \\r\\n            THEN valor_medio_parcela * 3\\r\\n            ELSE valor_medio_parcela * parcelas_restantes_estimada\\r\\n        END *\\r\\n        CASE risco_empresa\\r\\n            WHEN 'BAIXO' THEN 0.85\\r\\n            WHEN 'M\\u00c9DIO' THEN 0.65\\r\\n            WHEN 'ALTO' THEN 0.40\\r\\n            WHEN 'CR\\u00cdTICO' THEN 0.20\\r\\n            ELSE 0.50\\r\\n        END\\r\\n    AS DECIMAL(18,2)) AS valor_ajustado_risco_3_meses,\\r\\n    \\r\\n    -- Valor esperado ajustado pelo risco (12 meses)\\r\\n    CAST(\\r\\n        CASE \\r\\n            WHEN parcelas_restantes_estimada >= 12 \\r\\n            THEN valor_medio_parcela * 12\\r\\n            ELSE valor_medio_parcela * parcelas_restantes_estimada\\r\\n        END *\\r\\n        CASE risco_empresa\\r\\n            WHEN 'BAIXO' THEN 0.85\\r\\n            WHEN 'M\\u00c9DIO' THEN 0.65\\r\\n            WHEN 'ALTO' THEN 0.40\\r\\n            WHEN 'CR\\u00cdTICO' THEN 0.20\\r\\n            ELSE 0.50\\r\\n        END\\r\\n    AS DECIMAL(18,2)) AS valor_ajustado_risco_12_meses,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O ====================\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- ==================== METADADOS ====================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM parcelamentos_ativos\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 5: S\\u00c9RIE TEMPORAL DE PARCELAMENTOS\\r\\n-- ================================================================================\\r\\n-- Evolu\\u00e7\\u00e3o mensal para gr\\u00e1ficos de tend\\u00eancia\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_serie_temporal;\\r\\nCREATE TABLE gecob.parcel_serie_temporal STORED AS PARQUET AS\\r\\nSELECT\\r\\n    periodo_pedido,\\r\\n    ano_pedido,\\r\\n    mes_pedido,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso do per\\u00edodo\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Empresas \\u00fanicas\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 2 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelado,\\r\\n    CAST(SUM(CASE WHEN cd_status = 5 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitado,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativo,\\r\\n    \\r\\n    -- Por categoria\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'ICMS' THEN 1 ELSE 0 END) AS qtd_icms,\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'D\\u00cdVIDA ATIVA' THEN 1 ELSE 0 END) AS qtd_dva,\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'DECLARADO' THEN 1 ELSE 0 END) AS qtd_declarado,\\r\\n    SUM(CASE WHEN categoria_parcelamento = 'RECUPERA+' THEN 1 ELSE 0 END) AS qtd_recuperamais,\\r\\n    \\r\\n    -- Valores por categoria\\r\\n    CAST(SUM(CASE WHEN categoria_parcelamento = 'ICMS' THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_icms,\\r\\n    CAST(SUM(CASE WHEN categoria_parcelamento = 'D\\u00cdVIDA ATIVA' THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_dva,\\r\\n    CAST(SUM(CASE WHEN categoria_parcelamento = 'DECLARADO' THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_declarado,\\r\\n    CAST(SUM(CASE WHEN categoria_parcelamento = 'RECUPERA+' THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_recuperamais,\\r\\n    \\r\\n    -- M\\u00e9dias\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    CAST(AVG(num_parcelas) AS DECIMAL(10,1)) AS media_parcelas,\\r\\n    \\r\\n    -- Motivos de cancelamento\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 1 THEN 1 ELSE 0 END) AS cancelados_inadimplencia,\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 2 THEN 1 ELSE 0 END) AS cancelados_substituicao,\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento NOT IN (1,2) THEN 1 ELSE 0 END) AS cancelados_outros,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE periodo_pedido IS NOT NULL\\r\\nGROUP BY periodo_pedido, ano_pedido, mes_pedido\\r\\nORDER BY periodo_pedido\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 6: M\\u00c9TRICAS POR GERFE (Regional) - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe;\\r\\nCREATE TABLE gecob.parcel_metricas_gerfe STORED AS PARQUET AS\\r\\nSELECT\\r\\n    pb.cd_gerfe,\\r\\n    pb.gerfe,\\r\\n    \\r\\n    -- Quantidades totais\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT pb.cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN pb.cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN pb.cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN pb.cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN pb.cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(pb.valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 1 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 2 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 5 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- Ticket m\\u00e9dio\\r\\n    CAST(AVG(pb.valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Por categoria\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'ICMS' THEN 1 ELSE 0 END) AS qtd_icms,\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'D\\u00cdVIDA ATIVA' THEN 1 ELSE 0 END) AS qtd_dva,\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'RECUPERA+' THEN 1 ELSE 0 END) AS qtd_recuperamais,\\r\\n    \\r\\n    -- Empresas de risco (baseado no score se dispon\\u00edvel)\\r\\n    COUNT(DISTINCT CASE \\r\\n        WHEN es.classificacao_risco IN ('ALTO', 'CR\\u00cdTICO') THEN pb.cnpj_raiz \\r\\n    END) AS empresas_alto_risco,\\r\\n    \\r\\n    -- Valores de risco\\r\\n    CAST(SUM(\\r\\n        CASE WHEN es.classificacao_risco IN ('ALTO', 'CR\\u00cdTICO') AND pb.cd_status = 1 \\r\\n        THEN pb.valor_parcelado ELSE 0 END\\r\\n    ) AS DECIMAL(18,2)) AS valor_alto_risco_ativo,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base pb\\r\\nLEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\nWHERE pb.cd_gerfe IS NOT NULL\\r\\nGROUP BY pb.cd_gerfe, pb.gerfe\\r\\nORDER BY pb.cd_gerfe\\r\\n;\\r\\n\\r\\n-- Adicionar ranking ap\\u00f3s cria\\u00e7\\u00e3o (evita problemas com window function no GROUP BY)\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe_temp;\\r\\nALTER TABLE gecob.parcel_metricas_gerfe RENAME TO gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\nCREATE TABLE gecob.parcel_metricas_gerfe STORED AS PARQUET AS\\r\\nSELECT\\r\\n    *,\\r\\n    DENSE_RANK() OVER (ORDER BY taxa_sucesso_pct DESC NULLS LAST) AS ranking_taxa_sucesso\\r\\nFROM gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 7: M\\u00c9TRICAS POR GES (Ger\\u00eancia Setorial) - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_ges;\\r\\nCREATE TABLE gecob.parcel_metricas_ges STORED AS PARQUET AS\\r\\nSELECT\\r\\n    pb.cd_ges,\\r\\n    pb.ges,\\r\\n    \\r\\n    -- Quantidades totais\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT pb.cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN pb.cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN pb.cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN pb.cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(pb.valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 1 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    \\r\\n    -- Ticket m\\u00e9dio\\r\\n    CAST(AVG(pb.valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base pb\\r\\nWHERE pb.cd_ges IS NOT NULL\\r\\nGROUP BY pb.cd_ges, pb.ges\\r\\nORDER BY pb.cd_ges\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 8: AN\\u00c1LISE RECUPERA+ (Programa Especial) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_recuperamais;\\r\\nCREATE TABLE gecob.parcel_recuperamais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O ====================\\r\\n    num_parcelamento,\\r\\n    regra,\\r\\n    cod_receita,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Tipo de ades\\u00e3o\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2356, 2364, 2372) THEN 'COTA \\u00daNICA'\\r\\n        WHEN cod_receita IN (2380, 2399, 2402, 2410) THEN 'PARCELADO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS tipo_adesao,\\r\\n    \\r\\n    -- Origem do d\\u00e9bito\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2380) THEN 'DECLARADO'\\r\\n        WHEN cod_receita IN (2356, 2399) THEN 'DEFESA PR\\u00c9VIA'\\r\\n        WHEN cod_receita IN (2364, 2402) THEN 'NOTIFICA\\u00c7\\u00c3O FISCAL'\\r\\n        WHEN cod_receita IN (2372, 2410) THEN 'D\\u00cdVIDA ATIVA'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS origem_debito,\\r\\n    \\r\\n    -- Regra detalhada\\r\\n    CASE regra\\r\\n        WHEN 293 THEN 'ICMS DECLARADO (CONV 113/2023)'\\r\\n        WHEN 294 THEN 'ICMS NOTIFICA\\u00c7\\u00c3O FISCAL (CONV 113/2023)'\\r\\n        WHEN 295 THEN 'ICMS TERMO INTIM. DEFESA PR\\u00c9VIA (CONV 113/2023)'\\r\\n        WHEN 296 THEN 'ICMS D\\u00cdVIDA ATIVA (CONV 113/2023)'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS desc_regra,\\r\\n    \\r\\n    -- ==================== STATUS ====================\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    situacao_final,\\r\\n    cd_tipo_cancelamento,\\r\\n    desc_tipo_cancelamento,\\r\\n    \\r\\n    -- ==================== VALORES ====================\\r\\n    valor_parcelado,\\r\\n    saldo_imposto,\\r\\n    saldo_multa,\\r\\n    saldo_juros,\\r\\n    num_parcelas,\\r\\n    valor_medio_parcela,\\r\\n    \\r\\n    -- ==================== DATAS ====================\\r\\n    dt_pedido,\\r\\n    dt_autorizacao,\\r\\n    dt_cancelamento,\\r\\n    ano_pedido,\\r\\n    mes_pedido,\\r\\n    periodo_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    dias_ate_cancelamento,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O ====================\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- ==================== DADOS EMPRESA ====================\\r\\n    situacao_cadastral,\\r\\n    cnae,\\r\\n    descricao_cnae,\\r\\n    regime_apuracao,\\r\\n    \\r\\n    -- ==================== METADADOS ====================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE categoria_parcelamento = 'RECUPERA+'\\r\\n   OR regra IN (293, 294, 295, 296)\\r\\n   OR cod_receita IN (2348, 2356, 2364, 2372, 2380, 2399, 2402, 2410)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 9: PROGRAMAS ESPECIAIS (REFIS/PREFIS) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_programas_especiais;\\r\\nCREATE TABLE gecob.parcel_programas_especiais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identificador do programa\\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS programa,\\r\\n    \\r\\n    regra,\\r\\n    cod_receita,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN cd_status = 2 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN cd_status = 5 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- Por motivo de cancelamento\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 1 THEN 1 ELSE 0 END) AS cancel_inadimplencia,\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 2 THEN 1 ELSE 0 END) AS cancel_substituicao,\\r\\n    \\r\\n    -- Per\\u00edodo\\r\\n    MIN(dt_pedido) AS dt_primeira_adesao,\\r\\n    MAX(dt_pedido) AS dt_ultima_adesao,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE flag_programa_especial = 1\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END,\\r\\n    regra,\\r\\n    cod_receita\\r\\nORDER BY programa, regra\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 10: ALERTAS DE PARCELAMENTOS EM RISCO - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_alertas;\\r\\nCREATE TABLE gecob.parcel_alertas STORED AS PARQUET AS\\r\\nWITH parcelamentos_alerta AS (\\r\\n    SELECT\\r\\n        pb.num_parcelamento,\\r\\n        pb.cnpj_raiz,\\r\\n        pb.cnpj,\\r\\n        pb.inscricao_estadual,\\r\\n        pb.razao_social,\\r\\n        pb.regra,\\r\\n        pb.categoria_parcelamento,\\r\\n        pb.cd_status,\\r\\n        pb.desc_status,\\r\\n        pb.valor_parcelado,\\r\\n        pb.num_parcelas,\\r\\n        pb.dt_pedido,\\r\\n        pb.dias_vida_parcelamento,\\r\\n        pb.cd_gerfe,\\r\\n        pb.gerfe,\\r\\n        pb.cd_ges,\\r\\n        pb.ges,\\r\\n        pb.municipio,\\r\\n        es.score_risco_final,\\r\\n        es.classificacao_risco,\\r\\n        es.flag_reincidente,\\r\\n        es.flag_nunca_quitou,\\r\\n        \\r\\n        -- Tipo de alerta\\r\\n        CASE \\r\\n            -- Pendente 1\\u00aa parcela h\\u00e1 mais de 15 dias\\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 \\r\\n                THEN 'PENDENTE_1A_PARCELA_ATRASADA'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO'\\r\\n                THEN 'EMPRESA_RISCO_CRITICO'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO'\\r\\n                THEN 'EMPRESA_ALTO_RISCO'\\r\\n            \\r\\n            -- Parcelamento ativo com valor alto e empresa reincidente\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1\\r\\n                THEN 'VALOR_ALTO_REINCIDENTE'\\r\\n            \\r\\n            -- Empresa nunca quitou com novo parcelamento ativo\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1\\r\\n                THEN 'EMPRESA_NUNCA_QUITOU'\\r\\n            \\r\\n            ELSE NULL\\r\\n        END AS tipo_alerta,\\r\\n        \\r\\n        -- Prioridade\\r\\n        CASE \\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO' THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO' THEN 2\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1 THEN 2\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1 THEN 3\\r\\n            ELSE 4\\r\\n        END AS prioridade\\r\\n        \\r\\n    FROM gecob.parcel_base pb\\r\\n    LEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\n    WHERE pb.cd_status IN (1, 6)  -- Ativos ou pendentes 1\\u00aa parcela\\r\\n)\\r\\nSELECT\\r\\n    num_parcelamento,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Detalhes do parcelamento\\r\\n    regra,\\r\\n    categoria_parcelamento,\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    valor_parcelado,\\r\\n    num_parcelas,\\r\\n    dt_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    \\r\\n    -- Alerta\\r\\n    tipo_alerta,\\r\\n    prioridade,\\r\\n    CASE prioridade\\r\\n        WHEN 1 THEN 'URGENTE'\\r\\n        WHEN 2 THEN 'ALTA'\\r\\n        WHEN 3 THEN 'M\\u00c9DIA'\\r\\n        ELSE 'BAIXA'\\r\\n    END AS desc_prioridade,\\r\\n    \\r\\n    -- Score de risco\\r\\n    score_risco_final,\\r\\n    classificacao_risco,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM parcelamentos_alerta\\r\\nWHERE tipo_alerta IS NOT NULL\\r\\nORDER BY prioridade, valor_parcelado DESC\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 11: RESUMO EXECUTIVO (KPIs) - OK (sem JOIN problem\\u00e1tico)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_resumo_executivo;\\r\\nCREATE TABLE gecob.parcel_resumo_executivo STORED AS PARQUET AS\\r\\nSELECT\\r\\n    CURRENT_DATE() AS data_atualizacao,\\r\\n    \\r\\n    -- ==================== TOTAIS GERAIS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base) AS total_parcelamentos,\\r\\n    (SELECT COUNT(DISTINCT cnpj_raiz) FROM gecob.parcel_base) AS total_empresas,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) FROM gecob.parcel_base) AS valor_total_parcelado,\\r\\n    \\r\\n    -- ==================== POR STATUS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS qtd_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2) AS qtd_cancelados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5) AS qtd_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 6) AS qtd_pendentes_1a_parcela,\\r\\n    \\r\\n    -- ==================== VALORES POR STATUS ====================\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_ativos,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2) AS valor_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5) AS valor_quitados,\\r\\n    \\r\\n    -- ==================== TAXAS ====================\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_base) AS taxa_sucesso_global_pct,\\r\\n    \\r\\n    -- ==================== EXPECTATIVA DE RECEBIMENTO ====================\\r\\n    (SELECT CAST(SUM(valor_esperado_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_3_meses,\\r\\n    (SELECT CAST(SUM(valor_esperado_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_12_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_3_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_12_meses,\\r\\n    \\r\\n    -- ==================== ALERTAS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas) AS total_alertas,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 1) AS alertas_urgentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 2) AS alertas_alta_prioridade,\\r\\n    \\r\\n    -- ==================== SCORE DE RISCO ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'CR\\u00cdTICO') AS empresas_risco_critico,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'ALTO') AS empresas_risco_alto,\\r\\n    (SELECT CAST(SUM(valor_ativos) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')) AS valor_empresas_alto_risco,\\r\\n    \\r\\n    -- ==================== RECUPERA+ ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais) AS total_recuperamais,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 1) AS recuperamais_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 5) AS recuperamais_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 2) AS recuperamais_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais) AS valor_recuperamais,\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_recuperamais) AS taxa_sucesso_recuperamais_pct,\\r\\n    \\r\\n    -- ==================== POR CATEGORIA ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'ICMS') AS qtd_parcel_icms,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS qtd_parcel_dva,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'DECLARADO') AS qtd_parcel_declarado,\\r\\n    \\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'ICMS') AS valor_parcel_icms,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS valor_parcel_dva,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'DECLARADO') AS valor_parcel_declarado,\\r\\n    \\r\\n    -- ==================== PER\\u00cdODO ATUAL ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE()) AND mes_pedido = MONTH(CURRENT_DATE())) AS novos_mes_atual,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE())) AS novos_ano_atual,\\r\\n    \\r\\n    -- ==================== EMPRESAS REINCIDENTES ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_reincidente = 1) AS empresas_reincidentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_nunca_quitou = 1) AS empresas_nunca_quitaram\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 12: AN\\u00c1LISE POR FAIXA DE PARCELAS - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_faixas;\\r\\nCREATE TABLE gecob.parcel_analise_faixas STORED AS PARQUET AS\\r\\nSELECT\\r\\n    faixa_parcelas,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total,\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    CAST(AVG(num_parcelas) AS DECIMAL(10,1)) AS media_parcelas,\\r\\n    \\r\\n    -- Tempo m\\u00e9dio at\\u00e9 cancelamento\\r\\n    CAST(AVG(dias_ate_cancelamento) AS INT) AS media_dias_cancelamento,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nGROUP BY faixa_parcelas\\r\\nORDER BY \\r\\n    CASE faixa_parcelas\\r\\n        WHEN '01 - Cota \\u00danica' THEN 1\\r\\n        WHEN '02-12 parcelas' THEN 2\\r\\n        WHEN '13-24 parcelas' THEN 3\\r\\n        WHEN '25-36 parcelas' THEN 4\\r\\n        WHEN '37-60 parcelas' THEN 5\\r\\n        WHEN '61-120 parcelas' THEN 6\\r\\n        WHEN '121+ parcelas' THEN 7\\r\\n        ELSE 8\\r\\n    END\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 13: AN\\u00c1LISE POR CNAE (Setor Econ\\u00f4mico) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_cnae;\\r\\nCREATE TABLE gecob.parcel_analise_cnae STORED AS PARQUET AS\\r\\nSELECT\\r\\n    secao_cnae,\\r\\n    MAX(descricao_secao) AS descricao_secao,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE secao_cnae IS NOT NULL\\r\\nGROUP BY secao_cnae\\r\\nORDER BY valor_total DESC\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- QUERIES DE VALIDA\\u00c7\\u00c3O\\r\\n-- ================================================================================\\r\\n\\r\\nSELECT '>>> VALIDA\\u00c7\\u00c3O DAS TABELAS CORRIGIDAS <<<' AS info;\\r\\n\\r\\nSELECT 'gecob.parcel_metricas_gerfe' AS tabela, COUNT(*) AS registros FROM gecob.parcel_metricas_gerfe\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_metricas_ges', COUNT(*) FROM gecob.parcel_metricas_ges\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_recuperamais', COUNT(*) FROM gecob.parcel_recuperamais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_programas_especiais', COUNT(*) FROM gecob.parcel_programas_especiais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_alertas', COUNT(*) FROM gecob.parcel_alertas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_resumo_executivo', COUNT(*) FROM gecob.parcel_resumo_executivo\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_faixas', COUNT(*) FROM gecob.parcel_analise_faixas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_cnae', COUNT(*) FROM gecob.parcel_analise_cnae\\r\\nORDER BY 1;\\r\\n\\r\\n-- ================================================================================\\r\\n-- RESUMO DO PROJETO\\r\\n-- ================================================================================\\r\\nSELECT '>>> RESUMO DO PROJETO PARCEL <<<' AS info;\\r\\n\\r\\nSELECT \\r\\n    'PARCELAMENTOS ATIVOS' AS metrica,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS quantidade,\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_milhoes\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS CANCELADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS QUITADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'RECUPERA+ TOTAL',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'EMPRESAS ALTO RISCO',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')),\\r\\n    (SELECT CAST(SUM(valor_ativos)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO'))\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'ALERTAS ATIVOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_alertas);\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- FIM DO SCRIPT - PROJETO PARCEL v1.0\\r\\n-- ================================================================================\\r\\n-- \\r\\n-- PR\\u00d3XIMOS PASSOS PARA STREAMLIT:\\r\\n-- 1. Conectar ao Impala/Hive e carregar as tabelas gecob.parcel_*\\r\\n-- 2. Criar p\\u00e1ginas:\\r\\n--    - Dashboard Executivo (parcel_resumo_executivo)\\r\\n--    - Vis\\u00e3o Temporal (parcel_serie_temporal)\\r\\n--    - An\\u00e1lise por Regional (parcel_metricas_gerfe)\\r\\n--    - An\\u00e1lise por Setor (parcel_metricas_ges)\\r\\n--    - Perfil de Empresas (parcel_empresas + parcel_empresas_score)\\r\\n--    - Expectativa de Recebimento (parcel_expectativa_recebimento)\\r\\n--    - RECUPERA+ (parcel_recuperamais)\\r\\n--    - Alertas (parcel_alertas)\\r\\n-- 3. Implementar filtros interativos\\r\\n-- 4. Criar gr\\u00e1ficos e visualiza\\u00e7\\u00f5es\\r\\n-- 5. Exporta\\u00e7\\u00e3o de relat\\u00f3rios\\r\\n--\\r\\n-- ================================================================================\", \"statementsList\": [\"\\r\\nALTER TABLE gecob.parcel_metricas_gerfe RENAME TO gecob.parcel_metricas_gerfe_temp;\", \"\\r\\n\\r\\nCREATE TABLE gecob.parcel_metricas_gerfe STORED AS PARQUET AS\\r\\nSELECT\\r\\n    *,\\r\\n    DENSE_RANK() OVER (ORDER BY taxa_sucesso_pct DESC NULLS LAST) AS ranking_taxa_sucesso\\r\\nFROM gecob.parcel_metricas_gerfe_temp;\", \"\\r\\n\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe_temp;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 7: M\\u00c9TRICAS POR GES (Ger\\u00eancia Setorial) - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_ges;\", \"\\r\\nCREATE TABLE gecob.parcel_metricas_ges STORED AS PARQUET AS\\r\\nSELECT\\r\\n    pb.cd_ges,\\r\\n    pb.ges,\\r\\n    \\r\\n    -- Quantidades totais\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT pb.cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN pb.cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN pb.cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN pb.cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(pb.valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 1 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    \\r\\n    -- Ticket m\\u00e9dio\\r\\n    CAST(AVG(pb.valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base pb\\r\\nWHERE pb.cd_ges IS NOT NULL\\r\\nGROUP BY pb.cd_ges, pb.ges\\r\\nORDER BY pb.cd_ges\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 8: AN\\u00c1LISE RECUPERA+ (Programa Especial) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_recuperamais;\", \"\\r\\nCREATE TABLE gecob.parcel_recuperamais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O ====================\\r\\n    num_parcelamento,\\r\\n    regra,\\r\\n    cod_receita,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Tipo de ades\\u00e3o\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2356, 2364, 2372) THEN 'COTA \\u00daNICA'\\r\\n        WHEN cod_receita IN (2380, 2399, 2402, 2410) THEN 'PARCELADO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS tipo_adesao,\\r\\n    \\r\\n    -- Origem do d\\u00e9bito\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2380) THEN 'DECLARADO'\\r\\n        WHEN cod_receita IN (2356, 2399) THEN 'DEFESA PR\\u00c9VIA'\\r\\n        WHEN cod_receita IN (2364, 2402) THEN 'NOTIFICA\\u00c7\\u00c3O FISCAL'\\r\\n        WHEN cod_receita IN (2372, 2410) THEN 'D\\u00cdVIDA ATIVA'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS origem_debito,\\r\\n    \\r\\n    -- Regra detalhada\\r\\n    CASE regra\\r\\n        WHEN 293 THEN 'ICMS DECLARADO (CONV 113/2023)'\\r\\n        WHEN 294 THEN 'ICMS NOTIFICA\\u00c7\\u00c3O FISCAL (CONV 113/2023)'\\r\\n        WHEN 295 THEN 'ICMS TERMO INTIM. DEFESA PR\\u00c9VIA (CONV 113/2023)'\\r\\n        WHEN 296 THEN 'ICMS D\\u00cdVIDA ATIVA (CONV 113/2023)'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS desc_regra,\\r\\n    \\r\\n    -- ==================== STATUS ====================\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    situacao_final,\\r\\n    cd_tipo_cancelamento,\\r\\n    desc_tipo_cancelamento,\\r\\n    \\r\\n    -- ==================== VALORES ====================\\r\\n    valor_parcelado,\\r\\n    saldo_imposto,\\r\\n    saldo_multa,\\r\\n    saldo_juros,\\r\\n    num_parcelas,\\r\\n    valor_medio_parcela,\\r\\n    \\r\\n    -- ==================== DATAS ====================\\r\\n    dt_pedido,\\r\\n    dt_autorizacao,\\r\\n    dt_cancelamento,\\r\\n    ano_pedido,\\r\\n    mes_pedido,\\r\\n    periodo_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    dias_ate_cancelamento,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O ====================\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- ==================== DADOS EMPRESA ====================\\r\\n    situacao_cadastral,\\r\\n    cnae,\\r\\n    descricao_cnae,\\r\\n    regime_apuracao,\\r\\n    \\r\\n    -- ==================== METADADOS ====================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE categoria_parcelamento = 'RECUPERA+'\\r\\n   OR regra IN (293, 294, 295, 296)\\r\\n   OR cod_receita IN (2348, 2356, 2364, 2372, 2380, 2399, 2402, 2410)\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 9: PROGRAMAS ESPECIAIS (REFIS/PREFIS) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_programas_especiais;\", \"\\r\\nCREATE TABLE gecob.parcel_programas_especiais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identificador do programa\\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS programa,\\r\\n    \\r\\n    regra,\\r\\n    cod_receita,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN cd_status = 2 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN cd_status = 5 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- Por motivo de cancelamento\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 1 THEN 1 ELSE 0 END) AS cancel_inadimplencia,\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 2 THEN 1 ELSE 0 END) AS cancel_substituicao,\\r\\n    \\r\\n    -- Per\\u00edodo\\r\\n    MIN(dt_pedido) AS dt_primeira_adesao,\\r\\n    MAX(dt_pedido) AS dt_ultima_adesao,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE flag_programa_especial = 1\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END,\\r\\n    regra,\\r\\n    cod_receita\\r\\nORDER BY programa, regra\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 10: ALERTAS DE PARCELAMENTOS EM RISCO - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_alertas;\", \"\\r\\nCREATE TABLE gecob.parcel_alertas STORED AS PARQUET AS\\r\\nWITH parcelamentos_alerta AS (\\r\\n    SELECT\\r\\n        pb.num_parcelamento,\\r\\n        pb.cnpj_raiz,\\r\\n        pb.cnpj,\\r\\n        pb.inscricao_estadual,\\r\\n        pb.razao_social,\\r\\n        pb.regra,\\r\\n        pb.categoria_parcelamento,\\r\\n        pb.cd_status,\\r\\n        pb.desc_status,\\r\\n        pb.valor_parcelado,\\r\\n        pb.num_parcelas,\\r\\n        pb.dt_pedido,\\r\\n        pb.dias_vida_parcelamento,\\r\\n        pb.cd_gerfe,\\r\\n        pb.gerfe,\\r\\n        pb.cd_ges,\\r\\n        pb.ges,\\r\\n        pb.municipio,\\r\\n        es.score_risco_final,\\r\\n        es.classificacao_risco,\\r\\n        es.flag_reincidente,\\r\\n        es.flag_nunca_quitou,\\r\\n        \\r\\n        -- Tipo de alerta\\r\\n        CASE \\r\\n            -- Pendente 1\\u00aa parcela h\\u00e1 mais de 15 dias\\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 \\r\\n                THEN 'PENDENTE_1A_PARCELA_ATRASADA'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO'\\r\\n                THEN 'EMPRESA_RISCO_CRITICO'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO'\\r\\n                THEN 'EMPRESA_ALTO_RISCO'\\r\\n            \\r\\n            -- Parcelamento ativo com valor alto e empresa reincidente\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1\\r\\n                THEN 'VALOR_ALTO_REINCIDENTE'\\r\\n            \\r\\n            -- Empresa nunca quitou com novo parcelamento ativo\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1\\r\\n                THEN 'EMPRESA_NUNCA_QUITOU'\\r\\n            \\r\\n            ELSE NULL\\r\\n        END AS tipo_alerta,\\r\\n        \\r\\n        -- Prioridade\\r\\n        CASE \\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO' THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO' THEN 2\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1 THEN 2\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1 THEN 3\\r\\n            ELSE 4\\r\\n        END AS prioridade\\r\\n        \\r\\n    FROM gecob.parcel_base pb\\r\\n    LEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\n    WHERE pb.cd_status IN (1, 6)  -- Ativos ou pendentes 1\\u00aa parcela\\r\\n)\\r\\nSELECT\\r\\n    num_parcelamento,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Detalhes do parcelamento\\r\\n    regra,\\r\\n    categoria_parcelamento,\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    valor_parcelado,\\r\\n    num_parcelas,\\r\\n    dt_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    \\r\\n    -- Alerta\\r\\n    tipo_alerta,\\r\\n    prioridade,\\r\\n    CASE prioridade\\r\\n        WHEN 1 THEN 'URGENTE'\\r\\n        WHEN 2 THEN 'ALTA'\\r\\n        WHEN 3 THEN 'M\\u00c9DIA'\\r\\n        ELSE 'BAIXA'\\r\\n    END AS desc_prioridade,\\r\\n    \\r\\n    -- Score de risco\\r\\n    score_risco_final,\\r\\n    classificacao_risco,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM parcelamentos_alerta\\r\\nWHERE tipo_alerta IS NOT NULL\\r\\nORDER BY prioridade, valor_parcelado DESC\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 11: RESUMO EXECUTIVO (KPIs) - OK (sem JOIN problem\\u00e1tico)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_resumo_executivo;\", \"\\r\\nCREATE TABLE gecob.parcel_resumo_executivo STORED AS PARQUET AS\\r\\nSELECT\\r\\n    CURRENT_DATE() AS data_atualizacao,\\r\\n    \\r\\n    -- ==================== TOTAIS GERAIS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base) AS total_parcelamentos,\\r\\n    (SELECT COUNT(DISTINCT cnpj_raiz) FROM gecob.parcel_base) AS total_empresas,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) FROM gecob.parcel_base) AS valor_total_parcelado,\\r\\n    \\r\\n    -- ==================== POR STATUS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS qtd_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2) AS qtd_cancelados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5) AS qtd_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 6) AS qtd_pendentes_1a_parcela,\\r\\n    \\r\\n    -- ==================== VALORES POR STATUS ====================\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_ativos,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2) AS valor_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5) AS valor_quitados,\\r\\n    \\r\\n    -- ==================== TAXAS ====================\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_base) AS taxa_sucesso_global_pct,\\r\\n    \\r\\n    -- ==================== EXPECTATIVA DE RECEBIMENTO ====================\\r\\n    (SELECT CAST(SUM(valor_esperado_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_3_meses,\\r\\n    (SELECT CAST(SUM(valor_esperado_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_12_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_3_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_12_meses,\\r\\n    \\r\\n    -- ==================== ALERTAS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas) AS total_alertas,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 1) AS alertas_urgentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 2) AS alertas_alta_prioridade,\\r\\n    \\r\\n    -- ==================== SCORE DE RISCO ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'CR\\u00cdTICO') AS empresas_risco_critico,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'ALTO') AS empresas_risco_alto,\\r\\n    (SELECT CAST(SUM(valor_ativos) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')) AS valor_empresas_alto_risco,\\r\\n    \\r\\n    -- ==================== RECUPERA+ ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais) AS total_recuperamais,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 1) AS recuperamais_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 5) AS recuperamais_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 2) AS recuperamais_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais) AS valor_recuperamais,\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_recuperamais) AS taxa_sucesso_recuperamais_pct,\\r\\n    \\r\\n    -- ==================== POR CATEGORIA ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'ICMS') AS qtd_parcel_icms,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS qtd_parcel_dva,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'DECLARADO') AS qtd_parcel_declarado,\\r\\n    \\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'ICMS') AS valor_parcel_icms,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS valor_parcel_dva,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'DECLARADO') AS valor_parcel_declarado,\\r\\n    \\r\\n    -- ==================== PER\\u00cdODO ATUAL ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE()) AND mes_pedido = MONTH(CURRENT_DATE())) AS novos_mes_atual,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE())) AS novos_ano_atual,\\r\\n    \\r\\n    -- ==================== EMPRESAS REINCIDENTES ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_reincidente = 1) AS empresas_reincidentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_nunca_quitou = 1) AS empresas_nunca_quitaram\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 12: AN\\u00c1LISE POR FAIXA DE PARCELAS - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_faixas;\", \"\\r\\nCREATE TABLE gecob.parcel_analise_faixas STORED AS PARQUET AS\\r\\nSELECT\\r\\n    faixa_parcelas,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total,\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    CAST(AVG(num_parcelas) AS DECIMAL(10,1)) AS media_parcelas,\\r\\n    \\r\\n    -- Tempo m\\u00e9dio at\\u00e9 cancelamento\\r\\n    CAST(AVG(dias_ate_cancelamento) AS INT) AS media_dias_cancelamento,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nGROUP BY faixa_parcelas\\r\\nORDER BY \\r\\n    CASE faixa_parcelas\\r\\n        WHEN '01 - Cota \\u00danica' THEN 1\\r\\n        WHEN '02-12 parcelas' THEN 2\\r\\n        WHEN '13-24 parcelas' THEN 3\\r\\n        WHEN '25-36 parcelas' THEN 4\\r\\n        WHEN '37-60 parcelas' THEN 5\\r\\n        WHEN '61-120 parcelas' THEN 6\\r\\n        WHEN '121+ parcelas' THEN 7\\r\\n        ELSE 8\\r\\n    END\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 13: AN\\u00c1LISE POR CNAE (Setor Econ\\u00f4mico) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_cnae;\", \"\\r\\nCREATE TABLE gecob.parcel_analise_cnae STORED AS PARQUET AS\\r\\nSELECT\\r\\n    secao_cnae,\\r\\n    MAX(descricao_secao) AS descricao_secao,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE secao_cnae IS NOT NULL\\r\\nGROUP BY secao_cnae\\r\\nORDER BY valor_total DESC\\r\\n;\", \"\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- QUERIES DE VALIDA\\u00c7\\u00c3O\\r\\n-- ================================================================================\\r\\n\\r\\nSELECT '>>> VALIDA\\u00c7\\u00c3O DAS TABELAS CORRIGIDAS <<<' AS info;\", \"\\r\\n\\r\\nSELECT 'gecob.parcel_metricas_gerfe' AS tabela, COUNT(*) AS registros FROM gecob.parcel_metricas_gerfe\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_metricas_ges', COUNT(*) FROM gecob.parcel_metricas_ges\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_recuperamais', COUNT(*) FROM gecob.parcel_recuperamais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_programas_especiais', COUNT(*) FROM gecob.parcel_programas_especiais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_alertas', COUNT(*) FROM gecob.parcel_alertas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_resumo_executivo', COUNT(*) FROM gecob.parcel_resumo_executivo\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_faixas', COUNT(*) FROM gecob.parcel_analise_faixas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_cnae', COUNT(*) FROM gecob.parcel_analise_cnae\\r\\nORDER BY 1;\", \"\\r\\n\\r\\n-- ================================================================================\\r\\n-- RESUMO DO PROJETO\\r\\n-- ================================================================================\\r\\nSELECT '>>> RESUMO DO PROJETO PARCEL <<<' AS info;\", \"\\r\\n\\r\\nSELECT \\r\\n    'PARCELAMENTOS ATIVOS' AS metrica,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS quantidade,\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_milhoes\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS CANCELADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS QUITADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'RECUPERA+ TOTAL',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'EMPRESAS ALTO RISCO',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')),\\r\\n    (SELECT CAST(SUM(valor_ativos)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO'))\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'ALERTAS ATIVOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_alertas);\"], \"aceSize\": 100, \"status\": \"available\", \"statusForButtons\": \"executed\", \"properties\": {\"settings\": []}, \"viewSettings\": {\"placeHolder\": \"Example: SELECT * FROM tablename, or press CTRL + space\", \"sqlDialect\": true}, \"variables\": [], \"hasCurlyBracketParameters\": true, \"variableNames\": [], \"variableValues\": {}, \"statement\": \"\\r\\n-- ================================================================================\\r\\n-- TABELA 6: M\\u00c9TRICAS POR GERFE (Regional) - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe;\\r\\nCREATE TABLE gecob.parcel_metricas_gerfe STORED AS PARQUET AS\\r\\nSELECT\\r\\n    pb.cd_gerfe,\\r\\n    pb.gerfe,\\r\\n    \\r\\n    -- Quantidades totais\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT pb.cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN pb.cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN pb.cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN pb.cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN pb.cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(pb.valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 1 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 2 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 5 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- Ticket m\\u00e9dio\\r\\n    CAST(AVG(pb.valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Por categoria\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'ICMS' THEN 1 ELSE 0 END) AS qtd_icms,\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'D\\u00cdVIDA ATIVA' THEN 1 ELSE 0 END) AS qtd_dva,\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'RECUPERA+' THEN 1 ELSE 0 END) AS qtd_recuperamais,\\r\\n    \\r\\n    -- Empresas de risco (baseado no score se dispon\\u00edvel)\\r\\n    COUNT(DISTINCT CASE \\r\\n        WHEN es.classificacao_risco IN ('ALTO', 'CR\\u00cdTICO') THEN pb.cnpj_raiz \\r\\n    END) AS empresas_alto_risco,\\r\\n    \\r\\n    -- Valores de risco\\r\\n    CAST(SUM(\\r\\n        CASE WHEN es.classificacao_risco IN ('ALTO', 'CR\\u00cdTICO') AND pb.cd_status = 1 \\r\\n        THEN pb.valor_parcelado ELSE 0 END\\r\\n    ) AS DECIMAL(18,2)) AS valor_alto_risco_ativo,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base pb\\r\\nLEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\nWHERE pb.cd_gerfe IS NOT NULL\\r\\nGROUP BY pb.cd_gerfe, pb.gerfe\\r\\nORDER BY pb.cd_gerfe\\r\\n;\\r\\n\\r\\n-- Adicionar ranking ap\\u00f3s cria\\u00e7\\u00e3o (evita problemas com window function no GROUP BY)\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe_temp;\\r\\nALTER TABLE gecob.parcel_metricas_gerfe RENAME TO gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\nCREATE TABLE gecob.parcel_metricas_gerfe STORED AS PARQUET AS\\r\\nSELECT\\r\\n    *,\\r\\n    DENSE_RANK() OVER (ORDER BY taxa_sucesso_pct DESC NULLS LAST) AS ranking_taxa_sucesso\\r\\nFROM gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 7: M\\u00c9TRICAS POR GES (Ger\\u00eancia Setorial) - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_ges;\\r\\nCREATE TABLE gecob.parcel_metricas_ges STORED AS PARQUET AS\\r\\nSELECT\\r\\n    pb.cd_ges,\\r\\n    pb.ges,\\r\\n    \\r\\n    -- Quantidades totais\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT pb.cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN pb.cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN pb.cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN pb.cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(pb.valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 1 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    \\r\\n    -- Ticket m\\u00e9dio\\r\\n    CAST(AVG(pb.valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base pb\\r\\nWHERE pb.cd_ges IS NOT NULL\\r\\nGROUP BY pb.cd_ges, pb.ges\\r\\nORDER BY pb.cd_ges\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 8: AN\\u00c1LISE RECUPERA+ (Programa Especial) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_recuperamais;\\r\\nCREATE TABLE gecob.parcel_recuperamais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O ====================\\r\\n    num_parcelamento,\\r\\n    regra,\\r\\n    cod_receita,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Tipo de ades\\u00e3o\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2356, 2364, 2372) THEN 'COTA \\u00daNICA'\\r\\n        WHEN cod_receita IN (2380, 2399, 2402, 2410) THEN 'PARCELADO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS tipo_adesao,\\r\\n    \\r\\n    -- Origem do d\\u00e9bito\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2380) THEN 'DECLARADO'\\r\\n        WHEN cod_receita IN (2356, 2399) THEN 'DEFESA PR\\u00c9VIA'\\r\\n        WHEN cod_receita IN (2364, 2402) THEN 'NOTIFICA\\u00c7\\u00c3O FISCAL'\\r\\n        WHEN cod_receita IN (2372, 2410) THEN 'D\\u00cdVIDA ATIVA'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS origem_debito,\\r\\n    \\r\\n    -- Regra detalhada\\r\\n    CASE regra\\r\\n        WHEN 293 THEN 'ICMS DECLARADO (CONV 113/2023)'\\r\\n        WHEN 294 THEN 'ICMS NOTIFICA\\u00c7\\u00c3O FISCAL (CONV 113/2023)'\\r\\n        WHEN 295 THEN 'ICMS TERMO INTIM. DEFESA PR\\u00c9VIA (CONV 113/2023)'\\r\\n        WHEN 296 THEN 'ICMS D\\u00cdVIDA ATIVA (CONV 113/2023)'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS desc_regra,\\r\\n    \\r\\n    -- ==================== STATUS ====================\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    situacao_final,\\r\\n    cd_tipo_cancelamento,\\r\\n    desc_tipo_cancelamento,\\r\\n    \\r\\n    -- ==================== VALORES ====================\\r\\n    valor_parcelado,\\r\\n    saldo_imposto,\\r\\n    saldo_multa,\\r\\n    saldo_juros,\\r\\n    num_parcelas,\\r\\n    valor_medio_parcela,\\r\\n    \\r\\n    -- ==================== DATAS ====================\\r\\n    dt_pedido,\\r\\n    dt_autorizacao,\\r\\n    dt_cancelamento,\\r\\n    ano_pedido,\\r\\n    mes_pedido,\\r\\n    periodo_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    dias_ate_cancelamento,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O ====================\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- ==================== DADOS EMPRESA ====================\\r\\n    situacao_cadastral,\\r\\n    cnae,\\r\\n    descricao_cnae,\\r\\n    regime_apuracao,\\r\\n    \\r\\n    -- ==================== METADADOS ====================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE categoria_parcelamento = 'RECUPERA+'\\r\\n   OR regra IN (293, 294, 295, 296)\\r\\n   OR cod_receita IN (2348, 2356, 2364, 2372, 2380, 2399, 2402, 2410)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 9: PROGRAMAS ESPECIAIS (REFIS/PREFIS) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_programas_especiais;\\r\\nCREATE TABLE gecob.parcel_programas_especiais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identificador do programa\\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS programa,\\r\\n    \\r\\n    regra,\\r\\n    cod_receita,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN cd_status = 2 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN cd_status = 5 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- Por motivo de cancelamento\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 1 THEN 1 ELSE 0 END) AS cancel_inadimplencia,\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 2 THEN 1 ELSE 0 END) AS cancel_substituicao,\\r\\n    \\r\\n    -- Per\\u00edodo\\r\\n    MIN(dt_pedido) AS dt_primeira_adesao,\\r\\n    MAX(dt_pedido) AS dt_ultima_adesao,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE flag_programa_especial = 1\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END,\\r\\n    regra,\\r\\n    cod_receita\\r\\nORDER BY programa, regra\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 10: ALERTAS DE PARCELAMENTOS EM RISCO - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_alertas;\\r\\nCREATE TABLE gecob.parcel_alertas STORED AS PARQUET AS\\r\\nWITH parcelamentos_alerta AS (\\r\\n    SELECT\\r\\n        pb.num_parcelamento,\\r\\n        pb.cnpj_raiz,\\r\\n        pb.cnpj,\\r\\n        pb.inscricao_estadual,\\r\\n        pb.razao_social,\\r\\n        pb.regra,\\r\\n        pb.categoria_parcelamento,\\r\\n        pb.cd_status,\\r\\n        pb.desc_status,\\r\\n        pb.valor_parcelado,\\r\\n        pb.num_parcelas,\\r\\n        pb.dt_pedido,\\r\\n        pb.dias_vida_parcelamento,\\r\\n        pb.cd_gerfe,\\r\\n        pb.gerfe,\\r\\n        pb.cd_ges,\\r\\n        pb.ges,\\r\\n        pb.municipio,\\r\\n        es.score_risco_final,\\r\\n        es.classificacao_risco,\\r\\n        es.flag_reincidente,\\r\\n        es.flag_nunca_quitou,\\r\\n        \\r\\n        -- Tipo de alerta\\r\\n        CASE \\r\\n            -- Pendente 1\\u00aa parcela h\\u00e1 mais de 15 dias\\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 \\r\\n                THEN 'PENDENTE_1A_PARCELA_ATRASADA'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO'\\r\\n                THEN 'EMPRESA_RISCO_CRITICO'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO'\\r\\n                THEN 'EMPRESA_ALTO_RISCO'\\r\\n            \\r\\n            -- Parcelamento ativo com valor alto e empresa reincidente\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1\\r\\n                THEN 'VALOR_ALTO_REINCIDENTE'\\r\\n            \\r\\n            -- Empresa nunca quitou com novo parcelamento ativo\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1\\r\\n                THEN 'EMPRESA_NUNCA_QUITOU'\\r\\n            \\r\\n            ELSE NULL\\r\\n        END AS tipo_alerta,\\r\\n        \\r\\n        -- Prioridade\\r\\n        CASE \\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO' THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO' THEN 2\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1 THEN 2\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1 THEN 3\\r\\n            ELSE 4\\r\\n        END AS prioridade\\r\\n        \\r\\n    FROM gecob.parcel_base pb\\r\\n    LEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\n    WHERE pb.cd_status IN (1, 6)  -- Ativos ou pendentes 1\\u00aa parcela\\r\\n)\\r\\nSELECT\\r\\n    num_parcelamento,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Detalhes do parcelamento\\r\\n    regra,\\r\\n    categoria_parcelamento,\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    valor_parcelado,\\r\\n    num_parcelas,\\r\\n    dt_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    \\r\\n    -- Alerta\\r\\n    tipo_alerta,\\r\\n    prioridade,\\r\\n    CASE prioridade\\r\\n        WHEN 1 THEN 'URGENTE'\\r\\n        WHEN 2 THEN 'ALTA'\\r\\n        WHEN 3 THEN 'M\\u00c9DIA'\\r\\n        ELSE 'BAIXA'\\r\\n    END AS desc_prioridade,\\r\\n    \\r\\n    -- Score de risco\\r\\n    score_risco_final,\\r\\n    classificacao_risco,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM parcelamentos_alerta\\r\\nWHERE tipo_alerta IS NOT NULL\\r\\nORDER BY prioridade, valor_parcelado DESC\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 11: RESUMO EXECUTIVO (KPIs) - OK (sem JOIN problem\\u00e1tico)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_resumo_executivo;\\r\\nCREATE TABLE gecob.parcel_resumo_executivo STORED AS PARQUET AS\\r\\nSELECT\\r\\n    CURRENT_DATE() AS data_atualizacao,\\r\\n    \\r\\n    -- ==================== TOTAIS GERAIS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base) AS total_parcelamentos,\\r\\n    (SELECT COUNT(DISTINCT cnpj_raiz) FROM gecob.parcel_base) AS total_empresas,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) FROM gecob.parcel_base) AS valor_total_parcelado,\\r\\n    \\r\\n    -- ==================== POR STATUS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS qtd_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2) AS qtd_cancelados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5) AS qtd_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 6) AS qtd_pendentes_1a_parcela,\\r\\n    \\r\\n    -- ==================== VALORES POR STATUS ====================\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_ativos,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2) AS valor_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5) AS valor_quitados,\\r\\n    \\r\\n    -- ==================== TAXAS ====================\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_base) AS taxa_sucesso_global_pct,\\r\\n    \\r\\n    -- ==================== EXPECTATIVA DE RECEBIMENTO ====================\\r\\n    (SELECT CAST(SUM(valor_esperado_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_3_meses,\\r\\n    (SELECT CAST(SUM(valor_esperado_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_12_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_3_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_12_meses,\\r\\n    \\r\\n    -- ==================== ALERTAS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas) AS total_alertas,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 1) AS alertas_urgentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 2) AS alertas_alta_prioridade,\\r\\n    \\r\\n    -- ==================== SCORE DE RISCO ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'CR\\u00cdTICO') AS empresas_risco_critico,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'ALTO') AS empresas_risco_alto,\\r\\n    (SELECT CAST(SUM(valor_ativos) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')) AS valor_empresas_alto_risco,\\r\\n    \\r\\n    -- ==================== RECUPERA+ ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais) AS total_recuperamais,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 1) AS recuperamais_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 5) AS recuperamais_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 2) AS recuperamais_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais) AS valor_recuperamais,\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_recuperamais) AS taxa_sucesso_recuperamais_pct,\\r\\n    \\r\\n    -- ==================== POR CATEGORIA ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'ICMS') AS qtd_parcel_icms,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS qtd_parcel_dva,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'DECLARADO') AS qtd_parcel_declarado,\\r\\n    \\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'ICMS') AS valor_parcel_icms,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS valor_parcel_dva,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'DECLARADO') AS valor_parcel_declarado,\\r\\n    \\r\\n    -- ==================== PER\\u00cdODO ATUAL ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE()) AND mes_pedido = MONTH(CURRENT_DATE())) AS novos_mes_atual,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE())) AS novos_ano_atual,\\r\\n    \\r\\n    -- ==================== EMPRESAS REINCIDENTES ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_reincidente = 1) AS empresas_reincidentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_nunca_quitou = 1) AS empresas_nunca_quitaram\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 12: AN\\u00c1LISE POR FAIXA DE PARCELAS - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_faixas;\\r\\nCREATE TABLE gecob.parcel_analise_faixas STORED AS PARQUET AS\\r\\nSELECT\\r\\n    faixa_parcelas,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total,\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    CAST(AVG(num_parcelas) AS DECIMAL(10,1)) AS media_parcelas,\\r\\n    \\r\\n    -- Tempo m\\u00e9dio at\\u00e9 cancelamento\\r\\n    CAST(AVG(dias_ate_cancelamento) AS INT) AS media_dias_cancelamento,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nGROUP BY faixa_parcelas\\r\\nORDER BY \\r\\n    CASE faixa_parcelas\\r\\n        WHEN '01 - Cota \\u00danica' THEN 1\\r\\n        WHEN '02-12 parcelas' THEN 2\\r\\n        WHEN '13-24 parcelas' THEN 3\\r\\n        WHEN '25-36 parcelas' THEN 4\\r\\n        WHEN '37-60 parcelas' THEN 5\\r\\n        WHEN '61-120 parcelas' THEN 6\\r\\n        WHEN '121+ parcelas' THEN 7\\r\\n        ELSE 8\\r\\n    END\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 13: AN\\u00c1LISE POR CNAE (Setor Econ\\u00f4mico) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_cnae;\\r\\nCREATE TABLE gecob.parcel_analise_cnae STORED AS PARQUET AS\\r\\nSELECT\\r\\n    secao_cnae,\\r\\n    MAX(descricao_secao) AS descricao_secao,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE secao_cnae IS NOT NULL\\r\\nGROUP BY secao_cnae\\r\\nORDER BY valor_total DESC\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- QUERIES DE VALIDA\\u00c7\\u00c3O\\r\\n-- ================================================================================\\r\\n\\r\\nSELECT '>>> VALIDA\\u00c7\\u00c3O DAS TABELAS CORRIGIDAS <<<' AS info;\\r\\n\\r\\nSELECT 'gecob.parcel_metricas_gerfe' AS tabela, COUNT(*) AS registros FROM gecob.parcel_metricas_gerfe\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_metricas_ges', COUNT(*) FROM gecob.parcel_metricas_ges\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_recuperamais', COUNT(*) FROM gecob.parcel_recuperamais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_programas_especiais', COUNT(*) FROM gecob.parcel_programas_especiais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_alertas', COUNT(*) FROM gecob.parcel_alertas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_resumo_executivo', COUNT(*) FROM gecob.parcel_resumo_executivo\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_faixas', COUNT(*) FROM gecob.parcel_analise_faixas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_cnae', COUNT(*) FROM gecob.parcel_analise_cnae\\r\\nORDER BY 1;\\r\\n\\r\\n-- ================================================================================\\r\\n-- RESUMO DO PROJETO\\r\\n-- ================================================================================\\r\\nSELECT '>>> RESUMO DO PROJETO PARCEL <<<' AS info;\\r\\n\\r\\nSELECT \\r\\n    'PARCELAMENTOS ATIVOS' AS metrica,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS quantidade,\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_milhoes\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS CANCELADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS QUITADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'RECUPERA+ TOTAL',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'EMPRESAS ALTO RISCO',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')),\\r\\n    (SELECT CAST(SUM(valor_ativos)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO'))\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'ALERTAS ATIVOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_alertas);\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- FIM DO SCRIPT - PROJETO PARCEL v1.0\\r\\n-- ================================================================================\\r\\n-- \\r\\n-- PR\\u00d3XIMOS PASSOS PARA STREAMLIT:\\r\\n-- 1. Conectar ao Impala/Hive e carregar as tabelas gecob.parcel_*\\r\\n-- 2. Criar p\\u00e1ginas:\\r\\n--    - Dashboard Executivo (parcel_resumo_executivo)\\r\\n--    - Vis\\u00e3o Temporal (parcel_serie_temporal)\\r\\n--    - An\\u00e1lise por Regional (parcel_metricas_gerfe)\\r\\n--    - An\\u00e1lise por Setor (parcel_metricas_ges)\\r\\n--    - Perfil de Empresas (parcel_empresas + parcel_empresas_score)\\r\\n--    - Expectativa de Recebimento (parcel_expectativa_recebimento)\\r\\n--    - RECUPERA+ (parcel_recuperamais)\\r\\n--    - Alertas (parcel_alertas)\\r\\n-- 3. Implementar filtros interativos\\r\\n-- 4. Criar gr\\u00e1ficos e visualiza\\u00e7\\u00f5es\\r\\n-- 5. Exporta\\u00e7\\u00e3o de relat\\u00f3rios\\r\\n--\\r\\n-- ================================================================================\", \"result\": {\"id\": \"079b27c5-08cd-bc4b-9853-8840e118628a\", \"type\": \"table\", \"hasResultset\": true, \"handle\": {\"secret\": \"akkpxE3TQbG3oZVIdsVwrg==\", \"guid\": \"Y5el877HRLcAAAAAftn8/w==\", \"operation_type\": 0, \"has_result_set\": true, \"modified_row_count\": null, \"log_context\": null, \"session_guid\": \"ad44ad566c8f8f55:aae32f40e08277b2\", \"session_id\": 24517, \"session_type\": \"impala\", \"statement_id\": 23, \"has_more_statements\": true, \"statements_count\": 25, \"previous_statement_hash\": \"791a033a2d45284865d1a71791d73ed45a0507244d3e43f828f363e9\", \"start\": {\"row\": 594, \"column\": 0}, \"end\": {\"row\": 630, \"column\": 32}, \"statement\": \"SELECT \\n    'PARCELAMENTOS ATIVOS' AS metrica,\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS quantidade,\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_milhoes\\nUNION ALL\\nSELECT \\n    'PARCELAMENTOS CANCELADOS',\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2),\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\n     FROM gecob.parcel_base WHERE cd_status = 2)\\nUNION ALL\\nSELECT \\n    'PARCELAMENTOS QUITADOS',\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5),\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\n     FROM gecob.parcel_base WHERE cd_status = 5)\\nUNION ALL\\nSELECT \\n    'RECUPERA+ TOTAL',\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais),\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\n     FROM gecob.parcel_recuperamais)\\nUNION ALL\\nSELECT \\n    'EMPRESAS ALTO RISCO',\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')),\\n    (SELECT CAST(SUM(valor_ativos)/1000000 AS DECIMAL(18,2)) \\n     FROM gecob.parcel_empresas_score \\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO'))\\nUNION ALL\\nSELECT \\n    'ALERTAS ATIVOS',\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas),\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\n     FROM gecob.parcel_alertas)\"}, \"meta\": [], \"rows\": 6, \"hasMore\": false, \"statement_id\": 23, \"statement_range\": {\"start\": {\"row\": 594, \"column\": 0}, \"end\": {\"row\": 630, \"column\": 32}}, \"statements_count\": 25, \"metaFilter\": {\"query\": \"\", \"facets\": {}, \"text\": []}, \"isMetaFilterVisible\": false, \"filteredMetaChecked\": true, \"filteredColumnCount\": 3, \"filteredMeta\": [{\"type\": \"int\", \"name\": \"\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 0}, {\"name\": \"metrica\", \"type\": \"string\", \"comment\": null, \"cssClass\": \"sort-string\", \"checked\": true, \"originalIndex\": 1}, {\"name\": \"quantidade\", \"type\": \"bigint\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 2}, {\"name\": \"valor_milhoes\", \"type\": \"decimal\", \"comment\": null, \"cssClass\": \"sort-numeric\", \"checked\": true, \"originalIndex\": 3}], \"fetchedOnce\": false, \"startTime\": \"2026-01-10T19:50:49.890Z\", \"endTime\": \"2026-01-10T19:50:51.330Z\", \"executionTime\": 1440, \"data\": [], \"explanation\": \"\", \"logs\": \"\", \"logLines\": 3, \"hasSomeResults\": true}, \"showGrid\": true, \"showChart\": false, \"showLogs\": true, \"progress\": 0, \"jobs\": [], \"executeNextTimeout\": 6955, \"isLoading\": false, \"resultsKlass\": \"results impala\", \"errorsKlass\": \"results impala alert alert-error\", \"is_redacted\": false, \"chartType\": \"bars\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null, \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartLimits\": [5, 10, 25, 50, 100], \"chartLimit\": null, \"chartX\": \"metrica\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartYMulti\": [\"valor_milhoes\"], \"chartData\": [], \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"hideStacked\": true, \"hasDataForChart\": true, \"previousChartOptions\": {\"chartLimit\": null, \"chartX\": \"info\", \"chartXPivot\": null, \"chartYSingle\": null, \"chartMapType\": \"marker\", \"chartMapLabel\": null, \"chartMapHeat\": null, \"chartYMulti\": [], \"chartScope\": \"world\", \"chartTimelineType\": \"bar\", \"chartSorting\": \"none\", \"chartScatterGroup\": null, \"chartScatterSize\": null}, \"isResultSettingsVisible\": false, \"settingsVisible\": false, \"checkStatusTimeout\": 7796, \"getLogsTimeout\": 7874, \"topRisk\": null, \"suggestion\": \"\", \"hasSuggestion\": null, \"compatibilityCheckRunning\": false, \"compatibilitySourcePlatforms\": [{\"name\": \"Teradata\", \"value\": \"teradata\"}, {\"name\": \"Oracle\", \"value\": \"oracle\"}, {\"name\": \"Netezza\", \"value\": \"netezza\"}, {\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}, {\"name\": \"DB2\", \"value\": \"db2\"}, {\"name\": \"Greenplum\", \"value\": \"greenplum\"}, {\"name\": \"MySQL\", \"value\": \"mysql\"}, {\"name\": \"PostgreSQL\", \"value\": \"postgresql\"}, {\"name\": \"Informix\", \"value\": \"informix\"}, {\"name\": \"SQL Server\", \"value\": \"sqlserver\"}, {\"name\": \"Sybase\", \"value\": \"sybase\"}, {\"name\": \"Access\", \"value\": \"access\"}, {\"name\": \"Firebird\", \"value\": \"firebird\"}, {\"name\": \"ANSISQL\", \"value\": \"ansisql\"}, {\"name\": \"Generic\", \"value\": \"generic\"}], \"compatibilitySourcePlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"compatibilityTargetPlatforms\": [{\"name\": \"Impala\", \"value\": \"impala\"}, {\"name\": \"Hive\", \"value\": \"hive\"}], \"compatibilityTargetPlatform\": {\"name\": \"Impala\", \"value\": \"impala\"}, \"showSqlAnalyzer\": false, \"wasBatchExecuted\": false, \"isReady\": true, \"lastExecuted\": 1768074649648, \"lastAceSelectionRowOffset\": 746, \"executingBlockingOperation\": null, \"showLongOperationWarning\": false, \"lastExecutedStatements\": \"\\r\\n-- ================================================================================\\r\\n-- TABELA 6: M\\u00c9TRICAS POR GERFE (Regional) - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe;\\r\\nCREATE TABLE gecob.parcel_metricas_gerfe STORED AS PARQUET AS\\r\\nSELECT\\r\\n    pb.cd_gerfe,\\r\\n    pb.gerfe,\\r\\n    \\r\\n    -- Quantidades totais\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT pb.cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN pb.cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN pb.cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN pb.cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN pb.cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(pb.valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 1 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 2 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 5 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- Ticket m\\u00e9dio\\r\\n    CAST(AVG(pb.valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Por categoria\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'ICMS' THEN 1 ELSE 0 END) AS qtd_icms,\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'D\\u00cdVIDA ATIVA' THEN 1 ELSE 0 END) AS qtd_dva,\\r\\n    SUM(CASE WHEN pb.categoria_parcelamento = 'RECUPERA+' THEN 1 ELSE 0 END) AS qtd_recuperamais,\\r\\n    \\r\\n    -- Empresas de risco (baseado no score se dispon\\u00edvel)\\r\\n    COUNT(DISTINCT CASE \\r\\n        WHEN es.classificacao_risco IN ('ALTO', 'CR\\u00cdTICO') THEN pb.cnpj_raiz \\r\\n    END) AS empresas_alto_risco,\\r\\n    \\r\\n    -- Valores de risco\\r\\n    CAST(SUM(\\r\\n        CASE WHEN es.classificacao_risco IN ('ALTO', 'CR\\u00cdTICO') AND pb.cd_status = 1 \\r\\n        THEN pb.valor_parcelado ELSE 0 END\\r\\n    ) AS DECIMAL(18,2)) AS valor_alto_risco_ativo,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base pb\\r\\nLEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\nWHERE pb.cd_gerfe IS NOT NULL\\r\\nGROUP BY pb.cd_gerfe, pb.gerfe\\r\\nORDER BY pb.cd_gerfe\\r\\n;\\r\\n\\r\\n-- Adicionar ranking ap\\u00f3s cria\\u00e7\\u00e3o (evita problemas com window function no GROUP BY)\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe_temp;\\r\\nALTER TABLE gecob.parcel_metricas_gerfe RENAME TO gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\nCREATE TABLE gecob.parcel_metricas_gerfe STORED AS PARQUET AS\\r\\nSELECT\\r\\n    *,\\r\\n    DENSE_RANK() OVER (ORDER BY taxa_sucesso_pct DESC NULLS LAST) AS ranking_taxa_sucesso\\r\\nFROM gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_gerfe_temp;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 7: M\\u00c9TRICAS POR GES (Ger\\u00eancia Setorial) - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_metricas_ges;\\r\\nCREATE TABLE gecob.parcel_metricas_ges STORED AS PARQUET AS\\r\\nSELECT\\r\\n    pb.cd_ges,\\r\\n    pb.ges,\\r\\n    \\r\\n    -- Quantidades totais\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT pb.cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN pb.cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN pb.cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN pb.cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN pb.cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(pb.valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN pb.cd_status = 1 THEN pb.valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    \\r\\n    -- Ticket m\\u00e9dio\\r\\n    CAST(AVG(pb.valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base pb\\r\\nWHERE pb.cd_ges IS NOT NULL\\r\\nGROUP BY pb.cd_ges, pb.ges\\r\\nORDER BY pb.cd_ges\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 8: AN\\u00c1LISE RECUPERA+ (Programa Especial) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_recuperamais;\\r\\nCREATE TABLE gecob.parcel_recuperamais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- ==================== IDENTIFICA\\u00c7\\u00c3O ====================\\r\\n    num_parcelamento,\\r\\n    regra,\\r\\n    cod_receita,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Tipo de ades\\u00e3o\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2356, 2364, 2372) THEN 'COTA \\u00daNICA'\\r\\n        WHEN cod_receita IN (2380, 2399, 2402, 2410) THEN 'PARCELADO'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS tipo_adesao,\\r\\n    \\r\\n    -- Origem do d\\u00e9bito\\r\\n    CASE \\r\\n        WHEN cod_receita IN (2348, 2380) THEN 'DECLARADO'\\r\\n        WHEN cod_receita IN (2356, 2399) THEN 'DEFESA PR\\u00c9VIA'\\r\\n        WHEN cod_receita IN (2364, 2402) THEN 'NOTIFICA\\u00c7\\u00c3O FISCAL'\\r\\n        WHEN cod_receita IN (2372, 2410) THEN 'D\\u00cdVIDA ATIVA'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS origem_debito,\\r\\n    \\r\\n    -- Regra detalhada\\r\\n    CASE regra\\r\\n        WHEN 293 THEN 'ICMS DECLARADO (CONV 113/2023)'\\r\\n        WHEN 294 THEN 'ICMS NOTIFICA\\u00c7\\u00c3O FISCAL (CONV 113/2023)'\\r\\n        WHEN 295 THEN 'ICMS TERMO INTIM. DEFESA PR\\u00c9VIA (CONV 113/2023)'\\r\\n        WHEN 296 THEN 'ICMS D\\u00cdVIDA ATIVA (CONV 113/2023)'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS desc_regra,\\r\\n    \\r\\n    -- ==================== STATUS ====================\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    situacao_final,\\r\\n    cd_tipo_cancelamento,\\r\\n    desc_tipo_cancelamento,\\r\\n    \\r\\n    -- ==================== VALORES ====================\\r\\n    valor_parcelado,\\r\\n    saldo_imposto,\\r\\n    saldo_multa,\\r\\n    saldo_juros,\\r\\n    num_parcelas,\\r\\n    valor_medio_parcela,\\r\\n    \\r\\n    -- ==================== DATAS ====================\\r\\n    dt_pedido,\\r\\n    dt_autorizacao,\\r\\n    dt_cancelamento,\\r\\n    ano_pedido,\\r\\n    mes_pedido,\\r\\n    periodo_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    dias_ate_cancelamento,\\r\\n    \\r\\n    -- ==================== LOCALIZA\\u00c7\\u00c3O ====================\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- ==================== DADOS EMPRESA ====================\\r\\n    situacao_cadastral,\\r\\n    cnae,\\r\\n    descricao_cnae,\\r\\n    regime_apuracao,\\r\\n    \\r\\n    -- ==================== METADADOS ====================\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE categoria_parcelamento = 'RECUPERA+'\\r\\n   OR regra IN (293, 294, 295, 296)\\r\\n   OR cod_receita IN (2348, 2356, 2364, 2372, 2380, 2399, 2402, 2410)\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 9: PROGRAMAS ESPECIAIS (REFIS/PREFIS) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_programas_especiais;\\r\\nCREATE TABLE gecob.parcel_programas_especiais STORED AS PARQUET AS\\r\\nSELECT\\r\\n    -- Identificador do programa\\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END AS programa,\\r\\n    \\r\\n    regra,\\r\\n    cod_receita,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    SUM(CASE WHEN cd_status = 6 THEN 1 ELSE 0 END) AS qtd_pendentes_1a,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(SUM(CASE WHEN cd_status = 2 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_cancelados,\\r\\n    CAST(SUM(CASE WHEN cd_status = 5 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_quitados,\\r\\n    \\r\\n    -- Por motivo de cancelamento\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 1 THEN 1 ELSE 0 END) AS cancel_inadimplencia,\\r\\n    SUM(CASE WHEN cd_status = 2 AND cd_tipo_cancelamento = 2 THEN 1 ELSE 0 END) AS cancel_substituicao,\\r\\n    \\r\\n    -- Per\\u00edodo\\r\\n    MIN(dt_pedido) AS dt_primeira_adesao,\\r\\n    MAX(dt_pedido) AS dt_ultima_adesao,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE flag_programa_especial = 1\\r\\nGROUP BY \\r\\n    CASE \\r\\n        WHEN regra IN (293, 294, 295, 296) THEN 'RECUPERA+ (Lei 18.819/2024)'\\r\\n        WHEN regra IN (241, 245) THEN 'ITCMD ESPECIAL'\\r\\n        WHEN regra BETWEEN 290 AND 310 THEN 'PROGRAMA ESPECIAL 2024'\\r\\n        ELSE 'OUTROS'\\r\\n    END,\\r\\n    regra,\\r\\n    cod_receita\\r\\nORDER BY programa, regra\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 10: ALERTAS DE PARCELAMENTOS EM RISCO - CORRIGIDA\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_alertas;\\r\\nCREATE TABLE gecob.parcel_alertas STORED AS PARQUET AS\\r\\nWITH parcelamentos_alerta AS (\\r\\n    SELECT\\r\\n        pb.num_parcelamento,\\r\\n        pb.cnpj_raiz,\\r\\n        pb.cnpj,\\r\\n        pb.inscricao_estadual,\\r\\n        pb.razao_social,\\r\\n        pb.regra,\\r\\n        pb.categoria_parcelamento,\\r\\n        pb.cd_status,\\r\\n        pb.desc_status,\\r\\n        pb.valor_parcelado,\\r\\n        pb.num_parcelas,\\r\\n        pb.dt_pedido,\\r\\n        pb.dias_vida_parcelamento,\\r\\n        pb.cd_gerfe,\\r\\n        pb.gerfe,\\r\\n        pb.cd_ges,\\r\\n        pb.ges,\\r\\n        pb.municipio,\\r\\n        es.score_risco_final,\\r\\n        es.classificacao_risco,\\r\\n        es.flag_reincidente,\\r\\n        es.flag_nunca_quitou,\\r\\n        \\r\\n        -- Tipo de alerta\\r\\n        CASE \\r\\n            -- Pendente 1\\u00aa parcela h\\u00e1 mais de 15 dias\\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 \\r\\n                THEN 'PENDENTE_1A_PARCELA_ATRASADA'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO'\\r\\n                THEN 'EMPRESA_RISCO_CRITICO'\\r\\n            \\r\\n            -- Parcelamento ativo de empresa de alto risco\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO'\\r\\n                THEN 'EMPRESA_ALTO_RISCO'\\r\\n            \\r\\n            -- Parcelamento ativo com valor alto e empresa reincidente\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1\\r\\n                THEN 'VALOR_ALTO_REINCIDENTE'\\r\\n            \\r\\n            -- Empresa nunca quitou com novo parcelamento ativo\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1\\r\\n                THEN 'EMPRESA_NUNCA_QUITOU'\\r\\n            \\r\\n            ELSE NULL\\r\\n        END AS tipo_alerta,\\r\\n        \\r\\n        -- Prioridade\\r\\n        CASE \\r\\n            WHEN pb.cd_status = 6 AND pb.dias_vida_parcelamento > 15 THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'CR\\u00cdTICO' THEN 1\\r\\n            WHEN pb.cd_status = 1 AND es.classificacao_risco = 'ALTO' THEN 2\\r\\n            WHEN pb.cd_status = 1 AND pb.valor_parcelado >= 1000000 AND es.flag_reincidente = 1 THEN 2\\r\\n            WHEN pb.cd_status = 1 AND es.flag_nunca_quitou = 1 THEN 3\\r\\n            ELSE 4\\r\\n        END AS prioridade\\r\\n        \\r\\n    FROM gecob.parcel_base pb\\r\\n    LEFT JOIN gecob.parcel_empresas_score es ON pb.cnpj_raiz = es.cnpj_raiz\\r\\n    WHERE pb.cd_status IN (1, 6)  -- Ativos ou pendentes 1\\u00aa parcela\\r\\n)\\r\\nSELECT\\r\\n    num_parcelamento,\\r\\n    cnpj_raiz,\\r\\n    cnpj,\\r\\n    inscricao_estadual,\\r\\n    razao_social,\\r\\n    \\r\\n    -- Detalhes do parcelamento\\r\\n    regra,\\r\\n    categoria_parcelamento,\\r\\n    cd_status,\\r\\n    desc_status,\\r\\n    valor_parcelado,\\r\\n    num_parcelas,\\r\\n    dt_pedido,\\r\\n    dias_vida_parcelamento,\\r\\n    \\r\\n    -- Alerta\\r\\n    tipo_alerta,\\r\\n    prioridade,\\r\\n    CASE prioridade\\r\\n        WHEN 1 THEN 'URGENTE'\\r\\n        WHEN 2 THEN 'ALTA'\\r\\n        WHEN 3 THEN 'M\\u00c9DIA'\\r\\n        ELSE 'BAIXA'\\r\\n    END AS desc_prioridade,\\r\\n    \\r\\n    -- Score de risco\\r\\n    score_risco_final,\\r\\n    classificacao_risco,\\r\\n    \\r\\n    -- Localiza\\u00e7\\u00e3o\\r\\n    cd_gerfe,\\r\\n    gerfe,\\r\\n    cd_ges,\\r\\n    ges,\\r\\n    municipio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM parcelamentos_alerta\\r\\nWHERE tipo_alerta IS NOT NULL\\r\\nORDER BY prioridade, valor_parcelado DESC\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 11: RESUMO EXECUTIVO (KPIs) - OK (sem JOIN problem\\u00e1tico)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_resumo_executivo;\\r\\nCREATE TABLE gecob.parcel_resumo_executivo STORED AS PARQUET AS\\r\\nSELECT\\r\\n    CURRENT_DATE() AS data_atualizacao,\\r\\n    \\r\\n    -- ==================== TOTAIS GERAIS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base) AS total_parcelamentos,\\r\\n    (SELECT COUNT(DISTINCT cnpj_raiz) FROM gecob.parcel_base) AS total_empresas,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) FROM gecob.parcel_base) AS valor_total_parcelado,\\r\\n    \\r\\n    -- ==================== POR STATUS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS qtd_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2) AS qtd_cancelados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5) AS qtd_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 6) AS qtd_pendentes_1a_parcela,\\r\\n    \\r\\n    -- ==================== VALORES POR STATUS ====================\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_ativos,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2) AS valor_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5) AS valor_quitados,\\r\\n    \\r\\n    -- ==================== TAXAS ====================\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_base) AS taxa_sucesso_global_pct,\\r\\n    \\r\\n    -- ==================== EXPECTATIVA DE RECEBIMENTO ====================\\r\\n    (SELECT CAST(SUM(valor_esperado_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_3_meses,\\r\\n    (SELECT CAST(SUM(valor_esperado_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_12_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_3_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_3_meses,\\r\\n    (SELECT CAST(SUM(valor_ajustado_risco_12_meses) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_expectativa_recebimento) AS expectativa_ajustada_12_meses,\\r\\n    \\r\\n    -- ==================== ALERTAS ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas) AS total_alertas,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 1) AS alertas_urgentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas WHERE prioridade = 2) AS alertas_alta_prioridade,\\r\\n    \\r\\n    -- ==================== SCORE DE RISCO ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'CR\\u00cdTICO') AS empresas_risco_critico,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco = 'ALTO') AS empresas_risco_alto,\\r\\n    (SELECT CAST(SUM(valor_ativos) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')) AS valor_empresas_alto_risco,\\r\\n    \\r\\n    -- ==================== RECUPERA+ ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais) AS total_recuperamais,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 1) AS recuperamais_ativos,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 5) AS recuperamais_quitados,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais WHERE cd_status = 2) AS recuperamais_cancelados,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais) AS valor_recuperamais,\\r\\n    (SELECT ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n     , 2) FROM gecob.parcel_recuperamais) AS taxa_sucesso_recuperamais_pct,\\r\\n    \\r\\n    -- ==================== POR CATEGORIA ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'ICMS') AS qtd_parcel_icms,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS qtd_parcel_dva,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE categoria_parcelamento = 'DECLARADO') AS qtd_parcel_declarado,\\r\\n    \\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'ICMS') AS valor_parcel_icms,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'D\\u00cdVIDA ATIVA') AS valor_parcel_dva,\\r\\n    (SELECT CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE categoria_parcelamento = 'DECLARADO') AS valor_parcel_declarado,\\r\\n    \\r\\n    -- ==================== PER\\u00cdODO ATUAL ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE()) AND mes_pedido = MONTH(CURRENT_DATE())) AS novos_mes_atual,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base \\r\\n     WHERE ano_pedido = YEAR(CURRENT_DATE())) AS novos_ano_atual,\\r\\n    \\r\\n    -- ==================== EMPRESAS REINCIDENTES ====================\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_reincidente = 1) AS empresas_reincidentes,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas WHERE flag_nunca_quitou = 1) AS empresas_nunca_quitaram\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 12: AN\\u00c1LISE POR FAIXA DE PARCELAS - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_faixas;\\r\\nCREATE TABLE gecob.parcel_analise_faixas STORED AS PARQUET AS\\r\\nSELECT\\r\\n    faixa_parcelas,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total,\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    CAST(AVG(num_parcelas) AS DECIMAL(10,1)) AS media_parcelas,\\r\\n    \\r\\n    -- Tempo m\\u00e9dio at\\u00e9 cancelamento\\r\\n    CAST(AVG(dias_ate_cancelamento) AS INT) AS media_dias_cancelamento,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nGROUP BY faixa_parcelas\\r\\nORDER BY \\r\\n    CASE faixa_parcelas\\r\\n        WHEN '01 - Cota \\u00danica' THEN 1\\r\\n        WHEN '02-12 parcelas' THEN 2\\r\\n        WHEN '13-24 parcelas' THEN 3\\r\\n        WHEN '25-36 parcelas' THEN 4\\r\\n        WHEN '37-60 parcelas' THEN 5\\r\\n        WHEN '61-120 parcelas' THEN 6\\r\\n        WHEN '121+ parcelas' THEN 7\\r\\n        ELSE 8\\r\\n    END\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- TABELA 13: AN\\u00c1LISE POR CNAE (Setor Econ\\u00f4mico) - OK (sem JOIN)\\r\\n-- ================================================================================\\r\\nDROP TABLE IF EXISTS gecob.parcel_analise_cnae;\\r\\nCREATE TABLE gecob.parcel_analise_cnae STORED AS PARQUET AS\\r\\nSELECT\\r\\n    secao_cnae,\\r\\n    MAX(descricao_secao) AS descricao_secao,\\r\\n    \\r\\n    -- Quantidades\\r\\n    COUNT(*) AS total_parcelamentos,\\r\\n    COUNT(DISTINCT cnpj_raiz) AS empresas_distintas,\\r\\n    \\r\\n    -- Por status\\r\\n    SUM(CASE WHEN cd_status = 1 THEN 1 ELSE 0 END) AS qtd_ativos,\\r\\n    SUM(CASE WHEN cd_status = 2 THEN 1 ELSE 0 END) AS qtd_cancelados,\\r\\n    SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) AS qtd_quitados,\\r\\n    \\r\\n    -- Taxa de sucesso\\r\\n    ROUND(\\r\\n        SUM(CASE WHEN cd_status = 5 THEN 1 ELSE 0 END) * 100.0 /\\r\\n        NULLIF(SUM(CASE WHEN cd_status IN (2, 5) THEN 1 ELSE 0 END), 0)\\r\\n    , 2) AS taxa_sucesso_pct,\\r\\n    \\r\\n    -- Valores\\r\\n    CAST(SUM(valor_parcelado) AS DECIMAL(18,2)) AS valor_total,\\r\\n    CAST(SUM(CASE WHEN cd_status = 1 THEN valor_parcelado ELSE 0 END) AS DECIMAL(18,2)) AS valor_ativos,\\r\\n    CAST(AVG(valor_parcelado) AS DECIMAL(18,2)) AS ticket_medio,\\r\\n    \\r\\n    -- Metadados\\r\\n    CURRENT_TIMESTAMP() AS dt_carga\\r\\n\\r\\nFROM gecob.parcel_base\\r\\nWHERE secao_cnae IS NOT NULL\\r\\nGROUP BY secao_cnae\\r\\nORDER BY valor_total DESC\\r\\n;\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- QUERIES DE VALIDA\\u00c7\\u00c3O\\r\\n-- ================================================================================\\r\\n\\r\\nSELECT '>>> VALIDA\\u00c7\\u00c3O DAS TABELAS CORRIGIDAS <<<' AS info;\\r\\n\\r\\nSELECT 'gecob.parcel_metricas_gerfe' AS tabela, COUNT(*) AS registros FROM gecob.parcel_metricas_gerfe\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_metricas_ges', COUNT(*) FROM gecob.parcel_metricas_ges\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_recuperamais', COUNT(*) FROM gecob.parcel_recuperamais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_programas_especiais', COUNT(*) FROM gecob.parcel_programas_especiais\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_alertas', COUNT(*) FROM gecob.parcel_alertas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_resumo_executivo', COUNT(*) FROM gecob.parcel_resumo_executivo\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_faixas', COUNT(*) FROM gecob.parcel_analise_faixas\\r\\nUNION ALL\\r\\nSELECT 'gecob.parcel_analise_cnae', COUNT(*) FROM gecob.parcel_analise_cnae\\r\\nORDER BY 1;\\r\\n\\r\\n-- ================================================================================\\r\\n-- RESUMO DO PROJETO\\r\\n-- ================================================================================\\r\\nSELECT '>>> RESUMO DO PROJETO PARCEL <<<' AS info;\\r\\n\\r\\nSELECT \\r\\n    'PARCELAMENTOS ATIVOS' AS metrica,\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 1) AS quantidade,\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 1) AS valor_milhoes\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS CANCELADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 2),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 2)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'PARCELAMENTOS QUITADOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_base WHERE cd_status = 5),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_base WHERE cd_status = 5)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'RECUPERA+ TOTAL',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_recuperamais),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_recuperamais)\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'EMPRESAS ALTO RISCO',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO')),\\r\\n    (SELECT CAST(SUM(valor_ativos)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_empresas_score \\r\\n     WHERE classificacao_risco IN ('CR\\u00cdTICO', 'ALTO'))\\r\\nUNION ALL\\r\\nSELECT \\r\\n    'ALERTAS ATIVOS',\\r\\n    (SELECT COUNT(*) FROM gecob.parcel_alertas),\\r\\n    (SELECT CAST(SUM(valor_parcelado)/1000000 AS DECIMAL(18,2)) \\r\\n     FROM gecob.parcel_alertas);\\r\\n\\r\\n\\r\\n-- ================================================================================\\r\\n-- FIM DO SCRIPT - PROJETO PARCEL v1.0\\r\\n-- ================================================================================\\r\\n-- \\r\\n-- PR\\u00d3XIMOS PASSOS PARA STREAMLIT:\\r\\n-- 1. Conectar ao Impala/Hive e carregar as tabelas gecob.parcel_*\\r\\n-- 2. Criar p\\u00e1ginas:\\r\\n--    - Dashboard Executivo (parcel_resumo_executivo)\\r\\n--    - Vis\\u00e3o Temporal (parcel_serie_temporal)\\r\\n--    - An\\u00e1lise por Regional (parcel_metricas_gerfe)\\r\\n--    - An\\u00e1lise por Setor (parcel_metricas_ges)\\r\\n--    - Perfil de Empresas (parcel_empresas + parcel_empresas_score)\\r\\n--    - Expectativa de Recebimento (parcel_expectativa_recebimento)\\r\\n--    - RECUPERA+ (parcel_recuperamais)\\r\\n--    - Alertas (parcel_alertas)\\r\\n-- 3. Implementar filtros interativos\\r\\n-- 4. Criar gr\\u00e1ficos e visualiza\\u00e7\\u00f5es\\r\\n-- 5. Exporta\\u00e7\\u00e3o de relat\\u00f3rios\\r\\n--\\r\\n-- ================================================================================\", \"lastExecutedSelectionRange\": {\"start\": {\"row\": 746, \"column\": 0}, \"end\": {\"row\": 1398, \"column\": 83}}, \"formatEnabled\": true, \"isFetchingData\": false, \"isCanceling\": false, \"lastCheckStatusRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"query_status\\\": {\\\"status\\\": \\\"available\\\"}}\", \"responseJSON\": {\"status\": 0, \"query_status\": {\"status\": \"available\"}}, \"status\": 200, \"statusText\": \"OK\"}, \"lastGetLogsRequest\": {\"readyState\": 4, \"responseText\": \"{\\\"status\\\": 0, \\\"logs\\\": \\\"Query b744c7bef3a59763:fffcd97e00000000 100% Complete (12 out of 12)\\\", \\\"progress\\\": 100, \\\"jobs\\\": [{\\\"name\\\": \\\"b744c7bef3a59763:fffcd97e00000000\\\", \\\"url\\\": \\\"/hue/jobbrowser#!id=b744c7bef3a59763:fffcd97e00000000\\\", \\\"started\\\": true, \\\"finished\\\": false, \\\"percentJob\\\": 100}], \\\"isFullLogs\\\": false}\", \"responseJSON\": {\"status\": 0, \"logs\": \"Query b744c7bef3a59763:fffcd97e00000000 100% Complete (12 out of 12)\", \"progress\": 100, \"jobs\": [{\"name\": \"b744c7bef3a59763:fffcd97e00000000\", \"url\": \"/hue/jobbrowser#!id=b744c7bef3a59763:fffcd97e00000000\", \"started\": true, \"finished\": false, \"percentJob\": 100}], \"isFullLogs\": false}, \"status\": 200, \"statusText\": \"OK\"}}], \"selectedSnippet\": \"impala\", \"creatingSessionLocks\": [], \"sessions\": [], \"directoryUuid\": \"\", \"dependentsCoordinator\": [], \"historyFilter\": \"\", \"historyFilterVisible\": false, \"loadingHistory\": false, \"historyInitialHeight\": 18498, \"forceHistoryInitialHeight\": false, \"historyCurrentPage\": 1, \"historyTotalPages\": 245, \"schedulerViewModel\": null, \"schedulerViewModelIsLoaded\": false, \"isBatchable\": true, \"isExecutingAll\": false, \"executingAllIndex\": 0, \"retryModalConfirm\": null, \"retryModalCancel\": null, \"canSave\": true, \"unloaded\": false, \"updateHistoryFailed\": false, \"viewSchedulerId\": \"\", \"loadingScheduler\": false, \"is_history\": false}",
    "extra": "",
    "search": "-- ================================================================================\r\n-- PROJETO PARCEL - Sistema de Anlise e Monitoramento de Parcelamentos\r\n-- VERSO 1.0\r\n-- ================================================================================\r\n-- Objetivo: Criar tabelas analticas para dashboard Streamlit de parcelamentos\r\n--           incluindo mtricas, scores e projees de recebimento\r\n-- Schema: gecob.parcel_*\r\n-- Autor: SEF/SC - Secretaria de Estado da Fazenda de Santa Catarina\r\n-- Data: Janeiro/2026\r\n-- ================================================================================\r\n-- \r\n-- MAPEAMENTO DE TABELAS FONTE (Big Data):\r\n-- | Schema.Tabela                              | Descrio                          |\r\n-- |--------------------------------------------|-------------------------------------|\r\n-- | usr_sat_ctacte.tab_parcelamento_pedido     | Tabela principal de parcelamentos   |\r\n-- | usr_sat_ctacte.tab_cta_cte                 | Conta corrente fiscal               |\r\n-- | usr_sat_ods.vw_ods_contrib                 | Cadastro de contribuintes           |\r\n-- | usr_sat_ods.vw_dva_divida_ativa            | Dvida Ativa                        |\r\n-- | usr_sat_ods.vw_ods_pagamento               | Pagamentos realizados               |\r\n--\r\n-- STATUS DOS PARCELAMENTOS:\r\n-- | Cdigo | Status                    | Descrio                               |\r\n-- |--------|---------------------------|-----------------------------------------|\r\n-- | 1      | ATIVO/ABERTO              | Parcelamento em andamento               |\r\n-- | 2      | CANCELADO                 | Cancelado (geralmente 90 dias sem pagar)|\r\n-- | 3      | INATIVO/SUSPENSO          | Temporariamente suspenso                |\r\n-- | 4      | PENDENTE AUTORIZAO      | Aguardando aprovao                    |\r\n-- | 5      | QUITADO                   | Todas as parcelas pagas                 |\r\n-- | 6      | PENDENTE 1 PARCELA       | Contratou mas no pagou primeira parcela|\r\n-- ",
    "last_modified": "2026-01-10T16:50:58.064",
    "version": 1,
    "is_history": false,
    "is_managed": false,
    "is_trashed": false,
    "parent_directory": [
      "88237b9b-119d-4de7-8a4a-c83ee92463f3",
      1,
      false
    ],
    "dependencies": []
  }
}
]
